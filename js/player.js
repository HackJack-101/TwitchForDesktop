!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.video=t():(e.Twitch=e.Twitch||{},e.Twitch.video=t())}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerEmbed=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),a=r(s),u=n(191),c=r(u),l=n(4),f=r(l),d=n(65),h=n(66),p=n(75),_=n(78),v=n(77),g=t.PlayerEmbed=function(){function e(t,n){i(this,e),this._root=t;var r=(0,d.toString)((0,f["default"])(n,"width","height")),o=h.playerHost+"/?"+r,s=document.createElement("iframe");s.setAttribute("src",o),n.width&&s.setAttribute("width",n.width),n.height&&s.setAttribute("height",n.height),s.setAttribute("frameBorder","0"),s.setAttribute("allowFullScreen",""),s.setAttribute("scrolling","no"),(0,a["default"])(this._root)&&(this._root=document.getElementById(this._root)),this._root.appendChild(s),this._iframe=s,this._bridge=new p.EmbedClient(s.contentWindow)}return o(e,[{key:"play",value:function(){this._bridge.callPlayerMethod(v.METHOD_PLAY)}},{key:"pause",value:function(){this._bridge.callPlayerMethod(v.METHOD_PAUSE)}},{key:"seek",value:function(e){this._bridge.callPlayerMethod(v.METHOD_SEEK,e)}},{key:"setVolume",value:function(e){this._bridge.callPlayerMethod(v.METHOD_SET_VOLUME,e)}},{key:"setMuted",value:function(e){this._bridge.callPlayerMethod(v.METHOD_SET_MUTE,e)}},{key:"setChannel",value:function(e){this._bridge.callPlayerMethod(v.METHOD_SET_CHANNEL,e)}},{key:"setVideo",value:function(e){this._bridge.callPlayerMethod(v.METHOD_SET_VIDEO,e)}},{key:"setQuality",value:function(e){this._bridge.callPlayerMethod(v.METHOD_SET_QUALITY,e)}},{key:"setWidth",value:function(e){(0,c["default"])(e)&&e>=0&&this._iframe.setAttribute("width",e)}},{key:"setHeight",value:function(e){(0,c["default"])(e)&&e>=0&&this._iframe.setAttribute("height",e)}},{key:"addEventListener",value:function(e,t){this._bridge.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._bridge.removeEventListener(e,t)}},{key:"getChannel",value:function(){return this._bridge.getPlayerState().channelName}},{key:"getCurrentTime",value:function(){return this._bridge.getPlayerState().currentTime}},{key:"getDuration",value:function(){return this._bridge.getPlayerState().duration}},{key:"getEnded",value:function(){return this._bridge.getPlayerState().playback===_.PLAYBACK_ENDED}},{key:"getMuted",value:function(){return this._bridge.getPlayerState().muted}},{key:"getPlaybackStats",value:function(){return this._bridge.getPlayerState().stats}},{key:"isPaused",value:function(){return this._bridge.getPlayerState().playback===_.PLAYBACK_PAUSED}},{key:"getQuality",value:function(){return this._bridge.getPlayerState().quality}},{key:"getQualities",value:function(){return this._bridge.getPlayerState().qualitiesAvailable}},{key:"getViewers",value:function(){return this._bridge.getStoreState().viewercount}},{key:"getVideo",value:function(){return this._bridge.getPlayerState().videoID}},{key:"getVolume",value:function(){return this._bridge.getPlayerState().volume}}]),e}();window.Twitch=window.Twitch||{},window.Twitch.Player=g},function(e,t,n){function r(e){return"string"==typeof e||!i(e)&&o(e)&&u.call(e)==s}var i=n(2),o=n(3),s="[object String]",a=Object.prototype,u=a.toString;e.exports=r},function(e,t){var n=Array.isArray;e.exports=n},function(e,t){function n(e){return!!e&&"object"==typeof e}e.exports=n},function(e,t,n){var r=n(5),i=n(6),o=n(43),s=n(51),a=n(53),u=n(61),c=u(function(e,t){return null==e?{}:(t=r(o(t,1),String),s(e,i(a(e),t)))});e.exports=c},function(e,t){function n(e,t){for(var n=-1,r=e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}e.exports=n},function(e,t,n){function r(e,t,n,r){var f=-1,d=o,h=!0,p=e.length,_=[],v=t.length;if(!p)return _;n&&(t=a(t,u(n))),r?(d=s,h=!1):t.length>=l&&(d=c,h=!1,t=new i(t));e:for(;++f<p;){var g=e[f],m=n?n(g):g;if(h&&m===m){for(var y=v;y--;)if(t[y]===m)continue e;_.push(g)}else d(t,m,r)||_.push(g)}return _}var i=n(7),o=n(37),s=n(40),a=n(5),u=n(41),c=n(42),l=200;e.exports=r},function(e,t,n){function r(e){var t=-1,n=e?e.length:0;for(this.__data__=new i;++t<n;)this.push(e[t])}var i=n(8),o=n(36);r.prototype.push=o,e.exports=r},function(e,t,n){function r(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}var i=n(9),o=n(21),s=n(28),a=n(31),u=n(33);r.prototype.clear=i,r.prototype["delete"]=o,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,e.exports=r},function(e,t,n){function r(){this.__data__={hash:new i,map:o?new o:[],string:new i}}var i=n(10),o=n(17);e.exports=r},function(e,t,n){function r(){}var i=n(11),o=Object.prototype;r.prototype=i?i(null):o,e.exports=r},function(e,t,n){var r=n(12),i=r(Object,"create");e.exports=i},function(e,t,n){function r(e,t){var n=e[t];return i(n)?n:void 0}var i=n(13);e.exports=r},function(e,t,n){function r(e){return null==e?!1:i(e)?d.test(l.call(e)):s(e)&&(o(e)?d:u).test(e)}var i=n(14),o=n(16),s=n(3),a=/[\\^$.*+?()[\]{}|]/g,u=/^\[object .+?Constructor\]$/,c=Object.prototype,l=Function.prototype.toString,f=c.hasOwnProperty,d=RegExp("^"+l.call(f).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=r},function(e,t,n){function r(e){var t=i(e)?u.call(e):"";return t==o||t==s}var i=n(15),o="[object Function]",s="[object GeneratorFunction]",a=Object.prototype,u=a.toString;e.exports=r},function(e,t){function n(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=n},function(e,t){function n(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}e.exports=n},function(e,t,n){var r=n(12),i=n(18),o=r(i,"Map");e.exports=o},function(e,t,n){(function(e,r){var i=n(20),o={"function":!0,object:!0},s=o[typeof t]&&t&&!t.nodeType?t:void 0,a=o[typeof e]&&e&&!e.nodeType?e:void 0,u=i(s&&a&&"object"==typeof r&&r),c=i(o[typeof self]&&self),l=i(o[typeof window]&&window),f=i(o[typeof this]&&this),d=u||l!==(f&&f.window)&&l||c||f||Function("return this")();e.exports=d}).call(t,n(19)(e),function(){return this}())},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){function n(e){return e&&e.Object===Object?e:null}e.exports=n},function(e,t,n){function r(e){var t=this.__data__;return a(e)?s("string"==typeof e?t.string:t.hash,e):i?t.map["delete"](e):o(t.map,e)}var i=n(17),o=n(22),s=n(25),a=n(27);e.exports=r},function(e,t,n){function r(e,t){var n=i(e,t);if(0>n)return!1;var r=e.length-1;return n==r?e.pop():s.call(e,n,1),!0}var i=n(23),o=Array.prototype,s=o.splice;e.exports=r},function(e,t,n){function r(e,t){for(var n=e.length;n--;)if(i(e[n][0],t))return n;return-1}var i=n(24);e.exports=r},function(e,t){function n(e,t){return e===t||e!==e&&t!==t}e.exports=n},function(e,t,n){function r(e,t){return i(e,t)&&delete e[t]}var i=n(26);e.exports=r},function(e,t,n){function r(e,t){return i?void 0!==e[t]:s.call(e,t)}var i=n(11),o=Object.prototype,s=o.hasOwnProperty;e.exports=r},function(e,t){function n(e){var t=typeof e;return"number"==t||"boolean"==t||"string"==t&&"__proto__"!=e||null==e}e.exports=n},function(e,t,n){function r(e){var t=this.__data__;return a(e)?s("string"==typeof e?t.string:t.hash,e):i?t.map.get(e):o(t.map,e)}var i=n(17),o=n(29),s=n(30),a=n(27);e.exports=r},function(e,t,n){function r(e,t){var n=i(e,t);return 0>n?void 0:e[n][1]}var i=n(23);e.exports=r},function(e,t,n){function r(e,t){if(i){var n=e[t];return n===o?void 0:n}return a.call(e,t)?e[t]:void 0}var i=n(11),o="__lodash_hash_undefined__",s=Object.prototype,a=s.hasOwnProperty;e.exports=r},function(e,t,n){function r(e){var t=this.__data__;return a(e)?s("string"==typeof e?t.string:t.hash,e):i?t.map.has(e):o(t.map,e)}var i=n(17),o=n(32),s=n(26),a=n(27);e.exports=r},function(e,t,n){function r(e,t){return i(e,t)>-1}var i=n(23);e.exports=r},function(e,t,n){function r(e,t){var n=this.__data__;return a(e)?s("string"==typeof e?n.string:n.hash,e,t):i?n.map.set(e,t):o(n.map,e,t),this}var i=n(17),o=n(34),s=n(35),a=n(27);e.exports=r},function(e,t,n){function r(e,t,n){var r=i(e,t);0>r?e.push([t,n]):e[r][1]=n}var i=n(23);e.exports=r},function(e,t,n){function r(e,t,n){e[t]=i&&void 0===n?o:n}var i=n(11),o="__lodash_hash_undefined__";e.exports=r},function(e,t,n){function r(e){var t=this.__data__;if(i(e)){var n=t.__data__,r="string"==typeof e?n.string:n.hash;r[e]=o}else t.set(e,o)}var i=n(27),o="__lodash_hash_undefined__";e.exports=r},function(e,t,n){function r(e,t){return!!e.length&&i(e,t,0)>-1}var i=n(38);e.exports=r},function(e,t,n){function r(e,t,n){if(t!==t)return i(e,n);for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}var i=n(39);e.exports=r},function(e,t){function n(e,t,n){for(var r=e.length,i=t+(n?0:-1);n?i--:++i<r;){var o=e[i];if(o!==o)return i}return-1}e.exports=n},function(e,t){function n(e,t,n){for(var r=-1,i=e.length;++r<i;)if(n(t,e[r]))return!0;return!1}e.exports=n},function(e,t){function n(e){return function(t){return e(t)}}e.exports=n},function(e,t,n){function r(e,t){var n=e.__data__;if(i(t)){var r=n.__data__,s="string"==typeof t?r.string:r.hash;return s[t]===o}return n.has(t)}var i=n(27),o="__lodash_hash_undefined__";e.exports=r},function(e,t,n){function r(e,t,n,u){u||(u=[]);for(var c=-1,l=e.length;++c<l;){var f=e[c];t>0&&a(f)&&(n||s(f)||o(f))?t>1?r(f,t-1,n,u):i(u,f):n||(u[u.length]=f)}return u}var i=n(44),o=n(45),s=n(2),a=n(46);e.exports=r},function(e,t){function n(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}e.exports=n},function(e,t,n){function r(e){return i(e)&&a.call(e,"callee")&&(!c.call(e,"callee")||u.call(e)==o)}var i=n(46),o="[object Arguments]",s=Object.prototype,a=s.hasOwnProperty,u=s.toString,c=s.propertyIsEnumerable;e.exports=r},function(e,t,n){function r(e){return o(e)&&i(e)}var i=n(47),o=n(3);e.exports=r},function(e,t,n){function r(e){return null!=e&&s(i(e))&&!o(e)}var i=n(48),o=n(14),s=n(50);e.exports=r},function(e,t,n){var r=n(49),i=r("length");e.exports=i},function(e,t){function n(e){return function(t){return null==t?void 0:t[e]}}e.exports=n},function(e,t){function n(e){return"number"==typeof e&&e>-1&&e%1==0&&r>=e}var r=9007199254740991;e.exports=n},function(e,t,n){function r(e,t){return e=Object(e),i(t,function(t,n){return n in e&&(t[n]=e[n]),t},{})}var i=n(52);e.exports=r},function(e,t){function n(e,t,n,r){var i=-1,o=e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}e.exports=n},function(e,t,n){function r(e){for(var t=-1,n=a(e),r=i(e),u=r.length,l=o(e),f=!!l,d=l||[],h=d.length;++t<u;){var p=r[t];f&&("length"==p||s(p,h))||"constructor"==p&&(n||!c.call(e,p))||d.push(p)}return d}var i=n(54),o=n(57),s=n(59),a=n(60),u=Object.prototype,c=u.hasOwnProperty;e.exports=r},function(e,t,n){function r(e){e=null==e?e:Object(e);var t=[];for(var n in e)t.push(n);return t}var i=n(55),o=n(56),s=Object.prototype,a=i?i.enumerate:void 0,u=s.propertyIsEnumerable;a&&!u.call({valueOf:1},"valueOf")&&(r=function(e){return o(a(e))}),e.exports=r},function(e,t,n){var r=n(18),i=r.Reflect;e.exports=i},function(e,t){function n(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}e.exports=n},function(e,t,n){function r(e){var t=e?e.length:void 0;return a(t)&&(s(e)||u(e)||o(e))?i(t,String):null}var i=n(58),o=n(45),s=n(2),a=n(50),u=n(1);e.exports=r},function(e,t){function n(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}e.exports=n},function(e,t){function n(e,t){return e="number"==typeof e||i.test(e)?+e:-1,t=null==t?r:t,e>-1&&e%1==0&&t>e}var r=9007199254740991,i=/^(?:0|[1-9]\d*)$/;e.exports=n},function(e,t){function n(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||r;return e===n}var r=Object.prototype;e.exports=n},function(e,t,n){function r(e,t){if("function"!=typeof e)throw new TypeError(s);return t=a(void 0===t?e.length-1:o(t),0),function(){for(var n=arguments,r=-1,o=a(n.length-t,0),s=Array(o);++r<o;)s[r]=n[t+r];switch(t){case 0:return e.call(this,s);case 1:return e.call(this,n[0],s);case 2:return e.call(this,n[0],n[1],s)}var u=Array(t+1);for(r=-1;++r<t;)u[r]=n[r];return u[t]=s,i(e,this,u)}}var i=n(62),o=n(63),s="Expected a function",a=Math.max;e.exports=r},function(e,t){function n(e,t,n){var r=n.length;switch(r){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}e.exports=n},function(e,t,n){function r(e){if(!e)return 0===e?e:0;if(e=i(e),e===o||e===-o){var t=0>e?-1:1;return t*s}var n=e%1;return e===e?n?e-n:e:0}var i=n(64),o=1/0,s=1.7976931348623157e308;e.exports=r},function(e,t,n){function r(e){if(o(e)){var t=i(e.valueOf)?e.valueOf():e;e=o(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(a,"");var n=c.test(e);return n||l.test(e)?f(e.slice(2),n?2:8):u.test(e)?s:+e}var i=n(14),o=n(15),s=NaN,a=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,f=parseInt;e.exports=r},function(e,t){"use strict";function n(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var i=/^(.+?)(?:=(.+))?$/.exec(n[r]);if(i){var o=i[1],s=i[2];"true"===s?s=!0:"false"===s?s=!1:void 0!==s?s=decodeURIComponent(s):"!"===o[0]?(o=o.substring(1),s=!1):s=!0,t[o]=s}}return t}function r(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];n=encodeURIComponent(n),r===!0?t.push(n):r===!1?t.push("!"+n):(r=encodeURIComponent(r),t.push(n+"="+r))}return t.join("&")}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=n,t.toString=r},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.httpsQualityCarryover=t.unknownError=t.videoError=t.channelError=t.flashError=t.cancelResumeAmount=t.hotkeySeekAmount=t.defaultLanguage=t.leaveDialog=t.doubleClickUrl=t.flashTimeout=t.volumeStepAmount=t.embedParameters=t.mutedSegmentsMessage=t.chromecastStates=t.debugIgnoreEvents=t.allEvents=t.customEvents=t.mediaEvents=t.reportHideDelay=t.hoverControlsDelay=t.initialControlsDelay=t.qualityChangeDuration=t.qualityText=t.bufferPollDelay=t.pubSubEnviroment=t.version=t.chromecastId=t.popoutSize=t.gamePath=t.countessHost=t.spadeIgnore=t.spadeHost=t.mixpanelIgnore=t.mixpanelToken=t.mixpanelHost=t.trackingPlatform=t.apiTimeout=t.playerHost=t.valveApiHost=t.usherHost=t.spectreHost=t.apiHost=t.twitchHost=t.domain=void 0;var o=n(67),s=i(o),a=n(73),u=n(74),c=r(u),l="testplayer.twitch.tv",f=(t.domain="twitch.tv",t.twitchHost="//twitch.tv"),d=t.apiHost="https://api.twitch.tv",h=(t.spectreHost="//spectre.twitch.tv",t.usherHost="//usher.ttvnw.net",t.valveApiHost=d+"/steam/watching",t.playerHost=function(){var e=document.currentScript,t=document.getElementsByTagName("script");if(!e){var n=Array.prototype.filter.call(t,function(e){return e.src&&e.src.match(/player(?:\.\w+)?\.js$/i)});e=1===n.length?n[0]:t[t.length-1]}var r=(0,a.parseUri)(e.src);if(r.authority===l){var i=r.path.split("/").slice(1,-2).join("/");return r.protocol+"://"+r.authority+"/"+i}return r.protocol+"://"+r.authority}(),t.apiTimeout=1e4,t.trackingPlatform="web",t.mixpanelHost="//api.mixpanel.com",t.mixpanelToken="809576468572134f909dffa6bd0dcfcf",t.mixpanelIgnore=["minute-buffered","x_untrusted_video_init","x_untrusted_video-play","x_untrusted_minute-watched","x_untrusted_buffer-empty","x_untrusted_buffer-refill","network_profile"],t.spadeHost="//spade.twitch.tv",t.spadeIgnore=[],t.countessHost="//countess.twitch.tv",t.gamePath=f+"/directory/game",t.popoutSize={width:853,height:480},t.chromecastId="358E83DC",t.version="0.6.8",t.pubSubEnviroment="production",t.bufferPollDelay=1e3,t.qualityText={chunked:"Source",high:"High",medium:"Medium",low:"Low",mobile:"Mobile",auto:"Auto"},t.qualityChangeDuration=6e3,t.initialControlsDelay=8e3,t.hoverControlsDelay=5e3,t.reportHideDelay=2e3,t.mediaEvents=["loadstart","progress","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","play","pause","ratechange","volumechange"]),p=t.customEvents=["adcompanionrendered","castingchange","bufferChange","statschange","qualitychange","qualitieschange","adstart","adend","init","loadedchannel","loadedvideo","viewerschange","fullscreenchange","restricted",c.SEGMENT_CHANGE,"isspectre","theatrechange","online","offline","usherfail","captions"];t.allEvents=(0,s["default"])(h,p),t.debugIgnoreEvents=["statschange","timeupdate","bufferChange"],t.chromecastStates=["unavailable","available","connecting","connected","error"],t.mutedSegmentsMessage="Audio for portions of this video has been muted as it appears to contain copyrighted content owned or controlled by a third party.",t.embedParameters=["channel","video","muted","autoplay","time","t","debug","debug_ads","html5","quality","controls","devcaptions"],t.volumeStepAmount=.1,t.flashTimeout=5e3,t.doubleClickUrl="//pubads.g.doubleclick.net/gampad/ads",t.leaveDialog={enabled:!1,sinceEnded:45,viewerThreshold:5e4,text:"Don't panicBasket. The broadcast is down, but don't refresh just yet. When the broadcast is back, the player will automatically reload for you.",refreshTimeout:20,warningDuration:45},t.defaultLanguage="en-US",t.hotkeySeekAmount=5,t.cancelResumeAmount=10,t.flashError="No supported video backend available; Flash is not installed",t.channelError="Channel could not be found, or has been deleted by its owner",t.videoError="Video could not be found, or has been deleted by its owner",t.unknownError="An unknown error has occured",t.httpsQualityCarryover=new Date(2016,3,30)},function(e,t,n){var r=n(43),i=n(68),o=n(61),s=o(function(e){return i(r(e,1,!0))});e.exports=s},function(e,t,n){function r(e,t,n){var r=-1,f=o,d=e.length,h=!0,p=[],_=p;if(n)h=!1,f=s;else if(d>=l){var v=t?null:u(e);if(v)return c(v);h=!1,f=a,_=new i}else _=t?[]:p;e:for(;++r<d;){var g=e[r],m=t?t(g):g;if(h&&m===m){for(var y=_.length;y--;)if(_[y]===m)continue e;t&&_.push(m),p.push(g)}else f(_,m,n)||(_!==p&&_.push(m),p.push(g))}return p}var i=n(7),o=n(37),s=n(40),a=n(42),u=n(69),c=n(72),l=200;e.exports=r},function(e,t,n){var r=n(70),i=n(71),o=r&&2===new r([1,2]).size?function(e){return new r(e)}:i;e.exports=o},function(e,t,n){var r=n(12),i=n(18),o=r(i,"Set");e.exports=o},function(e,t){function n(){}e.exports=n},function(e,t){function n(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}e.exports=n},function(e,t){"use strict";function n(e){for(var t={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;i--;)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r}Object.defineProperty(t,"__esModule",{value:!0}),t.parseUri=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PLAYER_INIT="init",t.PLAYBACK_STATISTICS="playbackStatistics",t.SPECTRE_PLAYLIST="spectrePlaylist",t.CHANSUB_REQUIRED="chansubRequired",t.LOADED_CHANNEL="loadedchannel",t.LOADED_VIDEO="loadedvideo",t.VIDEO_FAILURE="videoFailure",t.FORMATS="videoFormats",t.FORMAT_CHANGED="videoFormatChanged",t.TIME_CHANGE="timeChange",t.BUFFER_CHANGE="bufferChange",t.SEGMENT_CHANGE="segmentchange",t.USHER_FAIL_ERROR="usherFail",t.CAPTION_UPDATE="captions",t.SEEK_FAILED="seekfailed",t.VIEWER_COUNT="viewerCount",t.VIEWERS_CHANGE="viewerschange",t.STREAM_LOADED="streamLoaded",t.VIDEO_LOADED="videoLoaded",t.VIDEO_PAUSED="videoPaused",t.QUALITIES_CHANGE="qualitieschange",t.QUALITY_CHANGE="qualitychange",t.OFFLINE="offline",t.STATS_CHANGE="statschange",t.RESTRICTED="restricted",t.IS_SPECTRE="isspectre"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.EmbedClient=t.EVENT_EMBED_READY=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(76),a=r(s),u=n(77),c=n(78),l=15e3,f=t.EVENT_EMBED_READY="ready";t.EmbedClient=function(){function e(t){i(this,e),this._host=t,this._eventEmitter=new a["default"],this._playerState=c.DEFAULT_EMBED_STATE,this._storeState={},this._onHostReady=this._getHostReady(),this._send(u.BRIDGE_REQ_SUBSCRIBE)}return o(e,[{key:"_getHostReady",value:function(){var e=this;return new Promise(function(t,n){function r(e){this._isClientMessage(e)&&e.data.method===u.BRIDGE_HOST_READY&&(window.removeEventListener("message",i),window.addEventListener("message",this),this._eventEmitter.emit(f),t())}var i=r.bind(e);window.addEventListener("message",i),setTimeout(n,l)})}},{key:"_send",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];var i={namespace:u.BRIDGE_HOST_NAMESPACE,method:e,args:n};this._host.postMessage(i,"*")}},{key:"_deferSend",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];this._onHostReady.then(function(){return e._send.apply(e,n)})}},{key:"_isClientMessage",value:function(e){return Boolean(e.data)&&e.data.namespace===u.BRIDGE_CLIENT_NAMESPACE}},{key:"handleEvent",value:function(e){if(this._isClientMessage(e))switch(e.data.method){case u.BRIDGE_STATE_UPDATE:this._playerState=e.data.args[0];break;case u.BRIDGE_PLAYER_EVENT:this._eventEmitter.emit(e.data.args[0]);break;case u.BRIDGE_STORE_STATE_UPDATE:this._storeState=e.data.args[0]}}},{key:"getPlayerState",value:function(){return this._playerState}},{key:"getStoreState",value:function(){return this._storeState}},{key:"addEventListener",value:function(e,t){this._eventEmitter.on(e,t)}},{key:"removeEventListener",value:function(e,t){this._eventEmitter.off(e,t)}},{key:"callPlayerMethod",value:function(e,t){this._deferSend(e,t)}}]),e}()},function(e,t,n){var r;(function(){"use strict";function t(){}function i(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function o(e){return function(){return this[e].apply(this,arguments)}}var s=t.prototype,a=this,u=a.EventEmitter;s.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},s.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},s.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},s.addListener=function(e,t){var n,r=this.getListenersAsObject(e),o="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===i(r[n],t)&&r[n].push(o?t:{listener:t,once:!1});return this},s.on=o("addListener"),s.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},s.once=o("addOnceListener"),s.defineEvent=function(e){return this.getListeners(e),this},s.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},s.removeListener=function(e,t){var n,r,o=this.getListenersAsObject(e);for(r in o)o.hasOwnProperty(r)&&(n=i(o[r],t),-1!==n&&o[r].splice(n,1));return this},s.off=o("removeListener"),s.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},s.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},s.manipulateListeners=function(e,t,n){var r,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)o.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?o.call(this,r,i):s.call(this,r,i));return this},s.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},s.removeAllListeners=o("removeEvent"),s.emitEvent=function(e,t){var n,r,i,o,s,a=this.getListenersAsObject(e);for(o in a)if(a.hasOwnProperty(o))for(n=a[o].slice(0),i=n.length;i--;)r=n[i],r.once===!0&&this.removeListener(e,r.listener),s=r.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},s.trigger=o("emitEvent"),s.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},s.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},s._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},s._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return a.EventEmitter=u,t},r=function(){return t}.call(a,n,a,e),!(void 0!==r&&(e.exports=r))}).call(this)},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.EmbedHost=t.BRIDGE_CLIENT_NAMESPACE=t.BRIDGE_HOST_NAMESPACE=t.BRIDGE_DOCUMENT_EVENT=t.BRIDGE_PLAYER_EVENT=t.BRIDGE_STORE_STATE_UPDATE=t.BRIDGE_STATE_UPDATE=t.BRIDGE_HOST_READY=t.BRIDGE_REQ_SUBSCRIBE=t.METHOD_DESTROY=t.METHOD_SET_VOLUME=t.METHOD_SET_MUTE=t.METHOD_SET_QUALITY=t.METHOD_SEEK=t.METHOD_SET_VIDEO=t.METHOD_SET_CHANNEL=t.METHOD_PAUSE=t.METHOD_PLAY=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(15),u=i(a),c=n(4),l=i(c),f=n(78),d=n(188),h=r(d),p=n(181),_=t.METHOD_PLAY="play",v=t.METHOD_PAUSE="pause",g=t.METHOD_SET_CHANNEL="channel",m=t.METHOD_SET_VIDEO="video",y=t.METHOD_SEEK="seek",b=t.METHOD_SET_QUALITY="quality",E=t.METHOD_SET_MUTE="mute",k=t.METHOD_SET_VOLUME="volume",w=t.METHOD_DESTROY="destroy",S=t.BRIDGE_REQ_SUBSCRIBE="subscribe",T=t.BRIDGE_HOST_READY="ready",O=t.BRIDGE_STATE_UPDATE="bridgestateupdate",A=t.BRIDGE_STORE_STATE_UPDATE="bridgestorestateupdate",P=t.BRIDGE_PLAYER_EVENT="bridgeplayerevent",R=t.BRIDGE_DOCUMENT_EVENT="bridgedocumentevent",I=t.BRIDGE_HOST_NAMESPACE="player.embed.host",M=t.BRIDGE_CLIENT_NAMESPACE="player.embed.client",C=["blur","focus","keydown","keypress","keyup","resize"];t.EmbedHost=function(){function e(t,n,r){var i=this;o(this,e),this._player=t,this._stateStore=r,this._clients=[],this._initWindowEvents(),n.addEventListener(f.EVENT_STATE_UPDATE,this._sendPlayerState.bind(this)),n.addEventListener(f.EVENT_PLAYER_UPDATE,this._sendPlayerEvent.bind(this)),window.addEventListener("message",this);var s=window.opener||window.parent;s&&s!==window&&this._addClient(s),this._unsubscribe=(0,p.subscribe)(this._stateStore,["viewercount"],function(){i._sendStoreState(),i._sendPlayerEvent("viewerschange")}),this._sendStoreState()}return s(e,[{key:"_initWindowEvents",value:function(){var e=this;C.forEach(function(t){document.addEventListener(t,function(n){var r=(0,l["default"])(n,u["default"]);e._sendAll(R,[t,r])})})}},{key:"_addClient",value:function(e){this._clients.push(e),this._send(e,T)}},{key:"_send",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],r=Array.isArray(n)?n:[n],i={namespace:M,method:t,args:r};e.postMessage(i,"*")}},{key:"_sendAll",value:function(e,t){var n=this;this._clients.forEach(function(r){n._send(r,e,t)})}},{key:"handleEvent",value:function(e){if((0,u["default"])(e.data)&&e.data.namespace===I)switch(e.data.method){case S:this._addClient(e.source);break;case _:this._player.play();break;case v:this._player.pause();break;case g:this._stateStore.dispatch(h.setChannel(e.data.args[0]));break;case m:this._stateStore.dispatch(h.setVideo(e.data.args[0]));break;case y:this._player.setCurrentTime(parseFloat(e.data.args[0]));break;case b:this._player.setQuality(e.data.args[0]);break;case E:this._player.setMuted(!!e.data.args[0]);break;case k:this._player.setVolume(parseFloat(e.data.args[0]));break;case w:this._player.destroy()}}},{key:"_sendPlayerState",value:function(e){this._sendAll(O,e.toJSON())}},{key:"_sendPlayerEvent",value:function(e){this._sendAll(P,e)}},{key:"_sendStoreState",value:function(){this._sendAll(A,{viewercount:this._stateStore.getState().viewercount})}}]),e}()},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.State=t.EVENT_AD_END=t.EVENT_AD_START=t.KEY_CAPTIONS_MODAL_SEEN=t.DEFAULT_EMBED_STATE=t.CHROMECAST_CONNECTED=t.CHROMECAST_CONNECTING=t.CHROMECAST_AVAILABLE=t.CHROMECAST_UNAVAILABLE=t.PLAYBACK_ENDED=t.PLAYBACK_PLAYING=t.PLAYBACK_PAUSED=t.EVENT_PLAYER_UPDATE=t.EVENT_STATE_UPDATE=void 0;var s=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(u){i=!0,o=u}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(79),c=i(u),l=n(76),f=i(l),d=n(85),h=n(152),p=n(66),_=r(p),v=n(162),g=n(147),m=r(g),y=n(167),b=r(y),E=n(168),k=i(E),w=n(169),S=n(186),T=n(164),O=r(T),A=n(74),P=r(A),R=n(166),I=r(R),M=n(183),C=n(184),L=t.EVENT_STATE_UPDATE="stateupdate",N=t.EVENT_PLAYER_UPDATE="player",x=t.PLAYBACK_PAUSED="paused",D=t.PLAYBACK_PLAYING="playing",j=t.PLAYBACK_ENDED="ended",U=t.CHROMECAST_UNAVAILABLE="unavailable",H=t.CHROMECAST_AVAILABLE="available",V=(t.CHROMECAST_CONNECTING="connecting",t.CHROMECAST_CONNECTED="connected"),B=(t.DEFAULT_EMBED_STATE={channelName:"",currentTime:0,duration:0,muted:!1,playback:"",quality:"",qualitiesAvailable:[],stats:{},videoID:"",viewers:0,volume:0},"mature"),q="vodResumeTimes",F="vodResumeWatcheds",G="leaveData",W=t.KEY_CAPTIONS_MODAL_SEEN="captionsModalSeen",z=[L,N],K=t.EVENT_AD_START="adstart",$=t.EVENT_AD_END="adend",Y="markerschange",J="mutedsegmentschange",Q="previewschange";t.State=function(){function e(t,n,r,i,s,a){o(this,e),this._options=a,this._backend=t,this._stateStore=i,this._pubSub=n,
this._timelineMetadata=new d.TimelineMetadata(s),this._fullscreen=r,this._eventEmitter=new f["default"],this._adrunning=!1,this._theatreModeEnabled=!1,this._isVODRestricted=!1,this._hasCurrentStreamPlayed=!1,this._viewers=0,this._markers=[],this._mutedSegments=[],this._previews=d.NULL_PREVIEW,_.allEvents.forEach(function(e){t.addEventListener(e,this.handleEvent.bind(this,e))},this),r.addEventListener(S.FULLSCREEN_CHANGE,this.handleEvent.bind(this,S.FULLSCREEN_CHANGE)),n.addEventListener(w.EVENT_ONLINE,this.handleEvent.bind(this,w.EVENT_ONLINE)),n.addEventListener(w.EVENT_OFFLINE,this.handleEvent.bind(this,w.EVENT_OFFLINE))}return a(e,[{key:"_onViewersChange",value:function(e){this._viewers=e.viewers,this._backend.onViewersChange&&this._backend.onViewersChange(e),this._eventEmitter.emit(L,this)}},{key:"canFullScreen",value:function(){return this._fullscreen.canFullScreen()}},{key:"isFullScreen",value:function(){return this._fullscreen.isFullScreen()}},{key:"getMarkers",value:function(){return this._markers}},{key:"isMature",value:function(){return b.get(B,!1)}},{key:"setIsMature",value:function(e){b.set(B,e)}},{key:"getMutedSegments",value:function(){return this._mutedSegments}},{key:"getPreviews",value:function(){return this._previews}},{key:"setSessionLeaveData",value:function(e){k["default"].setItem(G,e)}},{key:"setTheatreEnabled",value:function(e){this._theatreModeEnabled=e,this._eventEmitter.emit(L,this)}},{key:"isVODRestricted",value:function(){return this._isVODRestricted}},{key:"setVodResumeTimes",value:function(e){b.set(q,e)}},{key:"setVodResumeWatcheds",value:function(e){b.set(F,e)}},{key:"getChannelInfo",value:function(e){return m.channelInfo(e)}},{key:"getStreamInfo",value:function(e){return m.streamInfo(e)}},{key:"getVideoInfo",value:function(e){return m.videoInfo(e)}},{key:"getChannelViewerInfo",value:function(e){return m.channelViewerInfo(e)}},{key:"getOfflinePlaylistInfo",value:function(e){return this.getChannelInfo(e).then(function(e){return m.offlinePlaylistInfo(e._id)})}},{key:"getSeenCaptionsModal",value:function(){return b.get(W,!1)}},{key:"setSeenCaptionsModal",value:function(){b.set(W,!0)}},{key:"handleEvent",value:function(e,t){var n=this;switch(this._logStateChange(e),e){case K:this._adrunning=!0;break;case $:this._adrunning=!1;break;case P.SEGMENT_CHANGE:case"segmentchange":this._currentSegment=t;break;case P.LOADED_VIDEO:this._timelineMetadata.getMutedSegments(this.videoID).then(function(e){return n._updateMutedSegments(e)});break;case O.LOADED_METADATA:this._updateIsVODRestricted(),this._stateStore.getState().stream instanceof C.LiveContentStream&&this._stateStore.dispatch((0,M.setOnline)(!0));break;case O.LOADSTART:this._hasCurrentStreamPlayed=!1,this._resetTimelineMetadata(),this._updateIsVODRestricted();break;case O.PLAYING:!this._hasCurrentStreamPlayed&&this.videoID&&this._retrieveTimelineMetadata(),this._hasCurrentStreamPlayed=!0;break;case P.USHER_FAIL_ERROR:this._updateIsVODRestricted()}this._eventEmitter.emit(N,e),this._eventEmitter.emit(L,this)}},{key:"_resetTimelineMetadata",value:function(){this._markers=[],this._previews=d.NULL_PREVIEW,this._mutedSegments=[]}},{key:"_retrieveTimelineMetadata",value:function(){var e=this,t=this._stateStore.getState(),n=t.experiments;n.get(h.THUMBNAIL_PREVIEWS).then(function(t){"no"!==t&&m.videoInfo(e.videoID).then(function(t){return e._timelineMetadata.getPreviews(t)}).then(function(t){return e._updatePreviews(t)})}),n.get(h.MARKERS).then(function(t){"no"!==t&&m.videoInfo(e.videoID).then(function(t){return e._timelineMetadata.getMarkers(t)}).then(function(t){return e._updateMarkers(t)})})}},{key:"addEventListener",value:function(e,t){(0,c["default"])(z,e)&&this._eventEmitter.addListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._eventEmitter.removeListener(e,t)}},{key:"toJSON",value:function(){return{channelName:this.channelName,currentTime:this.currentTime,duration:this.duration,muted:this.muted,online:this.online,playback:this.playback,quality:this.quality,qualitiesAvailable:this.qualitiesAvailable,stats:this.stats,videoID:this.videoID,viewers:this.viewers,volume:this.volume}}},{key:"_logStateChange",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];this._options.debug&&!(0,c["default"])(_.debugIgnoreEvents,e)&&null!==e&&(console.groupCollapsed("state change: %s",e),console.log("partial state: %o",this.toJSON()),console.groupEnd())}},{key:"_updateMarkers",value:function(e){this._markers=e,this._logStateChange(Y),this._eventEmitter.emit(L,this)}},{key:"_updateMutedSegments",value:function(e){this._mutedSegments=e,this._logStateChange(J),this._eventEmitter.emit(L,this)}},{key:"_updatePreviews",value:function(e){this._previews=e,this._logStateChange(Q),this._eventEmitter.emit(L,this)}},{key:"_updateIsVODRestricted",value:function(){var e=this;if(this._isVODRestricted=!1,this._eventEmitter.emit(L,this),null!==this.videoID&&null===this.channelName){var t=m.videoInfo(this.videoID),n=t.then(function(e){return m.channelViewerInfo(e.channel.name)});Promise.all([t,n]).then(function(t){var n=s(t,2),r=n[0],i=n[1];e._isVODRestricted=m.isVODRestricted(i,r),e._eventEmitter.emit(L,e)})}}},{key:"destroy",value:function(){var e=this;z.map(function(t){e._eventEmitter.removeEvent(t)})}},{key:"isAdRunning",get:function(){return this._adrunning}},{key:"autoplayEnabled",get:function(){return this._backend.getAutoplay()}},{key:"buffered",get:function(){return this._backend.getBuffered()}},{key:"castingDevice",get:function(){return v.BackendChromecast.getDevice()}},{key:"castingState",get:function(){if(v.BackendChromecast.getReadyState()!==v.BackendChromecast.HAVE_NOTHING)return V;switch(v.BackendChromecast.getNetworkState()){case v.BackendChromecast.NETWORK_EMPTY:return U;case v.BackendChromecast.NETWORK_IDLE:return H;default:return V}}},{key:"channelName",get:function(){return this._backend.getChannel()}},{key:"currentBackend",get:function(){return this._backend.getBackend()}},{key:"currentTime",get:function(){return this._backend.getCurrentTime()}},{key:"duration",get:function(){return this._backend.getDuration()}},{key:"error",get:function(){return this._backend.error}},{key:"isLoading",get:function(){return this.playback===D&&this._backend.getReadyState()<=I.HAVE_CURRENT_DATA}},{key:"muted",get:function(){return this._backend.getMuted()}},{key:"online",get:function(){return this._stateStore.getState().online}},{key:"playback",get:function(){return this._backend.getPaused()?x:this._backend.getEnded()?j:D}},{key:"quality",get:function(){return this._backend.getQuality()}},{key:"qualitiesAvailable",get:function(){return this._backend.getQualities()}},{key:"sessionLeaveData",get:function(){return k["default"].getItem(G)}},{key:"isSeeking",get:function(){return this._backend.getSeeking()}},{key:"isSpectre",get:function(){return this._backend.isSpectre()}},{key:"stats",get:function(){return this._backend.getStats()}},{key:"supportedBackends",get:function(){return this._backend.getSupportedBackends()}},{key:"theatreEnabled",get:function(){return this._theatreModeEnabled}},{key:"viewers",get:function(){return this._viewers}},{key:"videoID",get:function(){return this._backend.getVideo()}},{key:"videoURL",get:function(){return this._backend.getVideoURL()}},{key:"vodResumeTimes",get:function(){return b.get(q,{})}},{key:"vodResumeWatcheds",get:function(){return b.get(F,{})}},{key:"volume",get:function(){return this._backend.getVolume()}},{key:"currentSegment",get:function(){return this._currentSegment}}]),e}()},function(e,t,n){function r(e,t,n,r){e=o(e)?e:u(e),n=n&&!r?a(n):0;var l=e.length;return 0>n&&(n=c(l+n,0)),s(e)?l>=n&&e.indexOf(t,n)>-1:!!l&&i(e,t,n)>-1}var i=n(38),o=n(47),s=n(1),a=n(63),u=n(80),c=Math.max;e.exports=r},function(e,t,n){function r(e){return e?i(e,o(e)):[]}var i=n(81),o=n(82);e.exports=r},function(e,t,n){function r(e,t){return i(t,function(t){return e[t]})}var i=n(5);e.exports=r},function(e,t,n){function r(e){var t=c(e);if(!t&&!a(e))return o(e);var n=s(e),r=!!n,l=n||[],f=l.length;for(var d in e)!i(e,d)||r&&("length"==d||u(d,f))||t&&"constructor"==d||l.push(d);return l}var i=n(83),o=n(84),s=n(57),a=n(47),u=n(59),c=n(60);e.exports=r},function(e,t){function n(e,t){return i.call(e,t)||"object"==typeof e&&t in e&&null===o(e)}var r=Object.prototype,i=r.hasOwnProperty,o=Object.getPrototypeOf;e.exports=n},function(e,t){function n(e){return r(Object(e))}var r=Object.keys;e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineMetadata=t.NULL_MARKER_THUMBNAIL=t.NULL_PREVIEW=void 0;var s,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(86),c=r(u),l=n(137),f=r(l),d=n(80),h=r(d),p=n(73),_=n(139),v=n(147),g=t.NULL_PREVIEW={count:0,lq:{width:0,height:0,rows:0,cols:0,URLs:[""]},hq:{width:0,height:0,rows:0,cols:0,URLs:[""]}},m=t.NULL_MARKER_THUMBNAIL={imageURL:"",x:0,y:0,width:0,height:0,cols:0},y="low",b="high",E="https://clipmn.twitch.tv/prod/",k="lol",w="hs",S="leagueOfLegendTags",T="hearthStoneOpeningTags",O="hearthStoneMatchTags",A="ungroupedTags",P=(s={},o(s,S,function(e,t,n){var r={title:"Match "+(t+1),info:"",startTime:e.start_sec,thumbnail:I(e,t,n)};return r}),o(s,O,function(e,t,n){var r={title:"Match "+(t+1),info:"<strong>"+e.game_data.characters[0]+"</strong> vs "+e.game_data.characters[1],startTime:e.start_sec,thumbnail:I(e,t,n)};return r}),s),R=function(){return null},I=function(e,t,n){return null===e.thumbnail_index?m:{imageURL:""+E+n.thumbnail_sheet,x:e.thumbnail_index[1]*n.thumbnail_size[0],y:e.thumbnail_index[0]*n.thumbnail_size[1],width:n.thumbnail_size[0],height:n.thumbnail_size[1],cols:n.sheet_dimensions[1]}};t.TimelineMetadata=function(){function e(t,n){i(this,e),this._analytics=t,this._options=n}return a(e,[{key:"getPreviews",value:function(e){var t=this;return(0,_.fetch)({url:e.seek_previews_url,dataType:"json"}).then(function(n){return t._normalizedPreviews(n,e.seek_previews_url)})["catch"](function(){return g})}},{key:"getMutedSegments",value:function(e){var t=this;return(0,v.videoInfo)(e).then(function(e){return t._normalizedMutedSegments(e.muted_segments)})["catch"](function(){return[]})}},{key:"getMarkers",value:function(e){var t=this;return(0,_.fetch)({url:E+"channels.json",dataType:"json"}).then(function(t){return-1===t.indexOf(e.channel.name)?Promise.reject("Current channel is not marker enabled"):(0,_.fetch)({url:""+E+e._id+".json",dataType:"json"})}).then(function(e){return t._analytics.trackEvent("vod_metadata_request",{response:"success"}),e}).then(this._normalizedMarkers)["catch"](function(n){return n.status&&-1!==n.responseText.indexOf(e._id+".json")&&t._analytics.trackEvent("vod_metadata_request",{response:"404"}),[]})}},{key:"_normalizedPreviews",value:function(e,t){if(null===e)return g;var n=(0,p.parseUri)(t),r=n.protocol+"://"+n.host+n.directory,i=e.map(function(e){return e.quality}),o=i.indexOf(y),s=i.indexOf(b);return{count:e[o].count,lq:{width:e[o].width,height:e[o].height,rows:e[o].rows,cols:e[o].cols,URLs:e[o].images.map(function(e){return""+r+e})},hq:{width:e[s].width,height:e[s].height,rows:e[s].rows,cols:e[s].cols,URLs:e[s].images.map(function(e){return""+r+e})}}}},{key:"_normalizedMutedSegments",value:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];if(e.length<=1)return e;var t=e.slice(0).sort(function(e,t){return e.offset-t.offset});return this._combineOverlappingSegments(t)}},{key:"_normalizedMarkers",value:function(e){if(null===e)return[];var t=(0,c["default"])(e.data.tags,function(e){switch(e.game_type){case k:return S;case w:switch(e.game_data.type){case 0:return O;case 1:return T}}return A});return Array.prototype.concat.apply([],(0,h["default"])((0,f["default"])(t,function(t,n){return t.map(function(t,r){var i=P[n]||R;return i(t,r,e.data)})}))).filter(function(e){return null!==e}).sort()}},{key:"_combineOverlappingSegments",value:function(e){return e.reduce(function(e,t){var n=e[e.length-1],r=n.offset+n.duration,i=t.offset+t.duration;return r<t.offset?e.push(t):i>r&&(n.duration=i-n.offset),e},[e[0]])}}]),e}()},function(e,t,n){var r=n(87),i=Object.prototype,o=i.hasOwnProperty,s=r(function(e,t,n){o.call(e,n)?e[n].push(t):e[n]=[t]});e.exports=s},function(e,t,n){function r(e,t){return function(n,r){var u=a(n)?i:o,c=t?t():{};return u(n,e,s(r),c)}}var i=n(88),o=n(89),s=n(95),a=n(2);e.exports=r},function(e,t){function n(e,t,n,r){for(var i=-1,o=e.length;++i<o;){var s=e[i];t(r,s,n(s),e)}return r}e.exports=n},function(e,t,n){function r(e,t,n,r){return i(e,function(e,i,o){t(r,e,n(e),o)}),r}var i=n(90);e.exports=r},function(e,t,n){var r=n(91),i=n(94),o=i(r);e.exports=o},function(e,t,n){function r(e,t){return e&&i(e,t,o)}var i=n(92),o=n(82);e.exports=r},function(e,t,n){var r=n(93),i=r();e.exports=i},function(e,t){function n(e){return function(t,n,r){for(var i=-1,o=Object(t),s=r(t),a=s.length;a--;){var u=s[e?a:++i];if(n(o[u],u,o)===!1)break}return t}}e.exports=n},function(e,t,n){function r(e,t){return function(n,r){if(null==n)return n;if(!i(n))return e(n,r);for(var o=n.length,s=t?o:-1,a=Object(n);(t?s--:++s<o)&&r(a[s],s,a)!==!1;);return n}}var i=n(47);e.exports=r},function(e,t,n){function r(e){var t=typeof e;return"function"==t?e:null==e?s:"object"==t?a(e)?o(e[0],e[1]):i(e):u(e)}var i=n(96),o=n(120),s=n(134),a=n(2),u=n(135);e.exports=r},function(e,t,n){function r(e){var t=o(e);if(1==t.length&&t[0][2]){var n=t[0][0],r=t[0][1];return function(e){return null==e?!1:e[n]===r&&(void 0!==r||n in Object(e))}}return function(n){return n===e||i(n,e,t)}}var i=n(97),o=n(116);e.exports=r},function(e,t,n){function r(e,t,n,r){var u=n.length,c=u,l=!r;if(null==e)return!c;for(e=Object(e);u--;){var f=n[u];if(l&&f[2]?f[1]!==e[f[0]]:!(f[0]in e))return!1}for(;++u<c;){f=n[u];var d=f[0],h=e[d],p=f[1];if(l&&f[2]){if(void 0===h&&!(d in e))return!1}else{var _=new i,v=r?r(h,p,d,e,t,_):void 0;if(!(void 0===v?o(p,h,r,s|a,_):v))return!1}}return!0}var i=n(98),o=n(104),s=1,a=2;e.exports=r},function(e,t,n){function r(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}var i=n(99),o=n(100),s=n(101),a=n(102),u=n(103);r.prototype.clear=i,r.prototype["delete"]=o,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,e.exports=r},function(e,t){function n(){this.__data__={array:[],map:null}}e.exports=n},function(e,t,n){function r(e){var t=this.__data__,n=t.array;return n?i(n,e):t.map["delete"](e)}var i=n(22);e.exports=r},function(e,t,n){function r(e){var t=this.__data__,n=t.array;return n?i(n,e):t.map.get(e)}var i=n(29);e.exports=r},function(e,t,n){function r(e){var t=this.__data__,n=t.array;return n?i(n,e):t.map.has(e)}var i=n(32);e.exports=r},function(e,t,n){function r(e,t){var n=this.__data__,r=n.array;r&&(r.length<s-1?o(r,e,t):(n.array=null,n.map=new i(r)));var a=n.map;return a&&a.set(e,t),this}var i=n(8),o=n(34),s=200;e.exports=r},function(e,t,n){function r(e,t,n,a,u){return e===t?!0:null==e||null==t||!o(e)&&!s(t)?e!==e&&t!==t:i(e,t,r,n,a,u)}var i=n(105),o=n(15),s=n(3);e.exports=r},function(e,t,n){function r(e,t,n,r,v,m){var y=c(e),b=c(t),E=p,k=p;y||(E=u(e),E=E==h?_:E),b||(k=u(t),k=k==h?_:k);var w=E==_&&!l(e),S=k==_&&!l(t),T=E==k;if(T&&!w)return m||(m=new i),y||f(e)?o(e,t,n,r,v,m):s(e,t,E,n,r,v,m);if(!(v&d)){var O=w&&g.call(e,"__wrapped__"),A=S&&g.call(t,"__wrapped__");if(O||A)return m||(m=new i),n(O?e.value():e,A?t.value():t,r,v,m)}return T?(m||(m=new i),a(e,t,n,r,v,m)):!1}var i=n(98),o=n(106),s=n(108),a=n(112),u=n(113),c=n(2),l=n(16),f=n(115),d=2,h="[object Arguments]",p="[object Array]",_="[object Object]",v=Object.prototype,g=v.hasOwnProperty;e.exports=r},function(e,t,n){function r(e,t,n,r,a,u){var c=-1,l=a&s,f=a&o,d=e.length,h=t.length;if(d!=h&&!(l&&h>d))return!1;var p=u.get(e);if(p)return p==t;var _=!0;for(u.set(e,t);++c<d;){var v=e[c],g=t[c];if(r)var m=l?r(g,v,c,t,e,u):r(v,g,c,e,t,u);if(void 0!==m){if(m)continue;_=!1;break}if(f){if(!i(t,function(e){return v===e||n(v,e,r,a,u)})){_=!1;break}}else if(v!==g&&!n(v,g,r,a,u)){_=!1;break}}return u["delete"](e),_}var i=n(107),o=1,s=2;e.exports=r},function(e,t){function n(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}e.exports=n},function(e,t,n){function r(e,t,n,r,i,E,w){switch(n){case b:return e.byteLength==t.byteLength&&r(new o(e),new o(t))?!0:!1;case f:case d:return+e==+t;case h:return e.name==t.name&&e.message==t.message;case _:return e!=+e?t!=+t:e==+t;case v:case m:return e==t+"";case p:var S=a;case g:var T=E&l;if(S||(S=u),e.size!=t.size&&!T)return!1;var O=w.get(e);return O?O==t:s(S(e),S(t),r,i,E|c,w.set(e,t));case y:if(k)return k.call(e)==k.call(t)}return!1}var i=n(109),o=n(110),s=n(106),a=n(111),u=n(72),c=1,l=2,f="[object Boolean]",d="[object Date]",h="[object Error]",p="[object Map]",_="[object Number]",v="[object RegExp]",g="[object Set]",m="[object String]",y="[object Symbol]",b="[object ArrayBuffer]",E=i?i.prototype:void 0,k=E?E.valueOf:void 0;e.exports=r},function(e,t,n){var r=n(18),i=r.Symbol;e.exports=i},function(e,t,n){var r=n(18),i=r.Uint8Array;e.exports=i},function(e,t){function n(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}e.exports=n},function(e,t,n){function r(e,t,n,r,a,u){var c=a&s,l=o(e),f=l.length,d=o(t),h=d.length;if(f!=h&&!c)return!1;for(var p=f;p--;){var _=l[p];if(!(c?_ in t:i(t,_)))return!1}var v=u.get(e);if(v)return v==t;var g=!0;u.set(e,t);for(var m=c;++p<f;){_=l[p];var y=e[_],b=t[_];if(r)var E=c?r(b,y,_,t,e,u):r(y,b,_,e,t,u);if(!(void 0===E?y===b||n(y,b,r,a,u):E)){g=!1;break}m||(m="constructor"==_)}if(g&&!m){var k=e.constructor,w=t.constructor;k!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof k&&k instanceof k&&"function"==typeof w&&w instanceof w)&&(g=!1)}return u["delete"](e),g}var i=n(83),o=n(82),s=2;e.exports=r},function(e,t,n){function r(e){return h.call(e)}var i=n(17),o=n(70),s=n(114),a="[object Map]",u="[object Object]",c="[object Set]",l="[object WeakMap]",f=Object.prototype,d=Function.prototype.toString,h=f.toString,p=i?d.call(i):"",_=o?d.call(o):"",v=s?d.call(s):"";(i&&r(new i)!=a||o&&r(new o)!=c||s&&r(new s)!=l)&&(r=function(e){var t=h.call(e),n=t==u?e.constructor:null,r="function"==typeof n?d.call(n):"";if(r)switch(r){case p:return a;case _:return c;case v:return l}return t}),e.exports=r},function(e,t,n){var r=n(12),i=n(18),o=r(i,"WeakMap");e.exports=o},function(e,t,n){function r(e){return o(e)&&i(e.length)&&!!R[M.call(e)]}var i=n(50),o=n(3),s="[object Arguments]",a="[object Array]",u="[object Boolean]",c="[object Date]",l="[object Error]",f="[object Function]",d="[object Map]",h="[object Number]",p="[object Object]",_="[object RegExp]",v="[object Set]",g="[object String]",m="[object WeakMap]",y="[object ArrayBuffer]",b="[object Float32Array]",E="[object Float64Array]",k="[object Int8Array]",w="[object Int16Array]",S="[object Int32Array]",T="[object Uint8Array]",O="[object Uint8ClampedArray]",A="[object Uint16Array]",P="[object Uint32Array]",R={};R[b]=R[E]=R[k]=R[w]=R[S]=R[T]=R[O]=R[A]=R[P]=!0,R[s]=R[a]=R[y]=R[u]=R[c]=R[l]=R[f]=R[d]=R[h]=R[p]=R[_]=R[v]=R[g]=R[m]=!1;var I=Object.prototype,M=I.toString;e.exports=r},function(e,t,n){function r(e){for(var t=o(e),n=t.length;n--;)t[n][2]=i(t[n][1]);return t}var i=n(117),o=n(118);e.exports=r},function(e,t,n){function r(e){return e===e&&!i(e)}var i=n(15);e.exports=r},function(e,t,n){function r(e){return i(e,o(e))}var i=n(119),o=n(82);e.exports=r},function(e,t,n){function r(e,t){return i(t,function(t){return[t,e[t]]})}var i=n(5);e.exports=r},function(e,t,n){function r(e,t){return function(n){var r=o(n,e);return void 0===r&&r===t?s(n,e):i(t,r,void 0,a|u)}}var i=n(104),o=n(121),s=n(128),a=1,u=2;e.exports=r},function(e,t,n){function r(e,t,n){var r=null==e?void 0:i(e,t);return void 0===r?n:r}var i=n(122);e.exports=r},function(e,t,n){function r(e,t){t=o(t,e)?[t+""]:i(t);for(var n=0,r=t.length;null!=e&&r>n;)e=e[t[n++]];return n&&n==r?e:void 0}var i=n(123),o=n(127);e.exports=r},function(e,t,n){function r(e){return i(e)?e:o(e)}var i=n(2),o=n(124);e.exports=r},function(e,t,n){function r(e){var t=[];return i(e).replace(o,function(e,n,r,i){t.push(r?i.replace(s,"$1"):n||e)}),t}var i=n(125),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,s=/\\(\\)?/g;e.exports=r},function(e,t,n){function r(e){if("string"==typeof e)return e;if(null==e)return"";if(o(e))return u?u.call(e):"";var t=e+"";return"0"==t&&1/e==-s?"-0":t}var i=n(109),o=n(126),s=1/0,a=i?i.prototype:void 0,u=a?a.toString:void 0;e.exports=r},function(e,t,n){function r(e){return"symbol"==typeof e||i(e)&&a.call(e)==o}var i=n(3),o="[object Symbol]",s=Object.prototype,a=s.toString;e.exports=r},function(e,t,n){function r(e,t){return"number"==typeof e?!0:!i(e)&&(s.test(e)||!o.test(e)||null!=t&&e in Object(t))}var i=n(2),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=r},function(e,t,n){function r(e,t){return o(e,t,i)}var i=n(129),o=n(130);e.exports=r},function(e,t){function n(e,t){return t in Object(e)}e.exports=n},function(e,t,n){function r(e,t,n){if(null==e)return!1;var r=n(e,t);r||u(t)||(t=i(t),e=d(e,t),null!=e&&(t=f(t),r=n(e,t)));var h=e?e.length:void 0;return r||!!h&&c(h)&&a(t,h)&&(s(e)||l(e)||o(e))}var i=n(123),o=n(45),s=n(2),a=n(59),u=n(127),c=n(50),l=n(1),f=n(131),d=n(132);e.exports=r},function(e,t){function n(e){var t=e?e.length:0;return t?e[t-1]:void 0}e.exports=n},function(e,t,n){function r(e,t){return 1==t.length?e:o(e,i(t,0,-1))}var i=n(133),o=n(121);e.exports=r},function(e,t){function n(e,t,n){var r=-1,i=e.length;0>t&&(t=-t>i?0:i+t),n=n>i?i:n,0>n&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}e.exports=n},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){function r(e){return s(e)?i(e):o(e)}var i=n(49),o=n(136),s=n(127);e.exports=r},function(e,t,n){function r(e){return function(t){return i(t,e)}}var i=n(122);e.exports=r},function(e,t,n){function r(e,t){var n=a(e)?i:s;return n(e,o(t,3))}var i=n(5),o=n(95),s=n(138),a=n(2);e.exports=r},function(e,t,n){function r(e,t){var n=-1,r=o(e)?Array(e.length):[];return i(e,function(e,i,o){r[++n]=t(e,i,o)}),r}var i=n(90),o=n(47);e.exports=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=(0,s["default"])({dataType:c,timeout:a.apiTimeout},e);return e.hasOwnProperty("data")&&(t.data=Object.keys(e.data).reduce(function(t,n){return null!==e.data[n]&&(t[n]=e.data[n]),t},{})),Promise.resolve($.ajax(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=i;var o=n(140),s=r(o),a=n(66),u=!!("withCredentials"in new XMLHttpRequest),c=u?"json":"jsonp"},function(e,t,n){e.exports=n(141)},function(e,t,n){var r=n(142),i=n(143),o=n(145),s=n(47),a=n(60),u=n(53),c=Object.prototype,l=c.propertyIsEnumerable,f=!l.call({valueOf:1},"valueOf"),d=o(function(e,t){if(f||a(t)||s(t))return void i(t,u(t),e);for(var n in t)r(e,n,t[n])});e.exports=d},function(e,t,n){function r(e,t,n){var r=e[t];s.call(e,t)&&i(r,n)&&(void 0!==n||t in e)||(e[t]=n)}var i=n(24),o=Object.prototype,s=o.hasOwnProperty;e.exports=r},function(e,t,n){function r(e,t,n){return i(e,t,n)}var i=n(144);e.exports=r},function(e,t,n){function r(e,t,n,r){n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],u=r?r(n[a],e[a],a,n,e):e[a];i(n,a,u)}return n}var i=n(142);e.exports=r},function(e,t,n){function r(e){return o(function(t,n){var r=-1,o=n.length,s=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(s="function"==typeof s?(o--,s):void 0,a&&i(n[0],n[1],a)&&(s=3>o?void 0:s,o=1),t=Object(t);++r<o;){var u=n[r];u&&e(t,u,r,s)}return t})}var i=n(146),o=n(61);e.exports=r},function(e,t,n){function r(e,t,n){if(!a(n))return!1;var r=typeof t;return("number"==r?o(n)&&s(t,n.length):"string"==r&&t in n)?i(n[t],e):!1}var i=n(24),o=n(47),s=n(59),a=n(15);e.exports=r},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.videoUrl=t.channelUrl=t.isVODRestricted=t.accessToken=t.oauthToken=t.channelAPIInfo=t.krakenUserInfo=t.userInfo=t.channelViewerInfo=t.offlinePlaylistInfo=t.streamInfo=t.productInfo=t.videoInfo=t.channelInfo=void 0;var o=n(140),s=i(o),a=n(148),u=i(a),c=n(149),l=i(c),f=n(150),d=i(f),h=n(66),p=r(h),_=!!("withCredentials"in new XMLHttpRequest),v=_?"json":"jsonp",g=function(e){return e.replace(/[^A-Za-z0-9_]/g,"")},m=(0,u["default"])(function(e){if(null===e)return Promise.reject(new Error("No channel info available on null channel ID"));var t=$.ajax({url:p.apiHost+"/kraken/channels/"+g(e),dataType:v,timeout:p.apiTimeout});return Promise.resolve(t)}),y=(0,u["default"])(function(e){if(null===e)return Promise.reject(new Error("No video info available on null video ID"));var t=$.ajax({url:p.apiHost+"/kraken/videos/"+g(e),dataType:v,timeout:p.apiTimeout}),n=$.ajax({url:p.apiHost+"/api/videos/"+g(e),dataType:"jsonp",timeout:p.apiTimeout}).then(function(e){return(0,l["default"])(e,["muted_segments","increment_view_count_url","restrictions","seek_previews_url"])}),r=Promise.all([t,n]);return r.then(function(e){return(0,s["default"])({},e[0],e[1])})}),b=(0,u["default"])(function(e){var t=$.ajax({url:p.apiHost+"/api/channels/"+g(e)+"/product",dataType:v,timeout:p.apiTimeout});return Promise.resolve(t)}),E=(0,u["default"])(function(e){var t=$.ajax({url:p.apiHost+"/kraken/streams/"+g(e),dataType:v,timeout:p.apiTimeout});return Promise.resolve(t)}),k=function(e){var t=$.ajax({url:p.spectreHost+"/v1/channels/"+e,dataType:"jsonp",timeout:p.apiTimeout});return Promise.resolve(t)},w=(0,u["default"])(function(e){var t=$.ajax({url:p.apiHost+"/api/channels/"+g(e)+"/viewer",xhrFields:{withCredentials:!0},dataType:v,timeout:p.apiTimeout});return Promise.resolve(t)}),S=(0,u["default"])(function(){return A().then(function(){var e=$.ajax({url:p.apiHost+"/api/viewer/info.json",xhrFields:{withCredentials:!0},dataType:v,timeout:p.apiTimeout});return Promise.resolve(e)})}),T=(0,u["default"])(function(){return A().then(function(e){var t=$.ajax({url:p.apiHost+"/kraken/user",headers:{Accept:"application/vnd.twitchtv.v2+json",Authorization:"OAuth "+e.token},dataType:v,timeout:p.apiTimeout});return Promise.resolve(t)})}),O=(0,u["default"])(function(e){return A().then(function(){var t=$.ajax({url:p.apiHost+"/api/channels/"+e,dataType:v,timeout:p.apiTimeout});return Promise.resolve(t)})}),A=(0,u["default"])(function(){var e=$.ajax({url:p.apiHost+"/api/viewer/token.json",xhrFields:{withCredentials:!0},dataType:v,timeout:p.apiTimeout});return Promise.resolve(e)}),P=function(e,t){var n=function(n){var r;"channel"===e?r=p.apiHost+"/api/channels/"+g(t)+"/access_token":"video"===e&&(r=p.apiHost+"/api/vods/"+g(t)+"/access_token");var i=$.ajax({url:r,data:{oauth_token:n},xhrFields:{withCredentials:!0},dataType:v,timeout:p.apiTimeout});return Promise.resolve(i)};return A().then(function(e){return n(e.token)},function(){return n()})},R=function(e,t){return null!==e.chansub||e.is_admin?!1:(0,d["default"])(t.restrictions,function(e,t){return e||"chansub"===t},!1)},I=function(e,t){var n=p.twitchHost+"/"+g(e);return t&&(n+="?"+$.param(t)),n},M=function(e,t,n){var r=I(e),i=t[0],o=t.substring(1);return r+="/"+g(i)+"/"+g(o),n&&(r+="?"+$.param(n)),r};t.channelInfo=m,t.videoInfo=y,t.productInfo=b,t.streamInfo=E,t.offlinePlaylistInfo=k,t.channelViewerInfo=w,t.userInfo=S,t.krakenUserInfo=T,t.channelAPIInfo=O,t.oauthToken=A,t.accessToken=P,t.isVODRestricted=R,t.channelUrl=I,t.videoUrl=M},function(e,t,n){function r(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(o);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=e.apply(this,r);return n.cache=o.set(i,s),s};return n.cache=new r.Cache,n}var i=n(8),o="Expected a function";r.Cache=i,e.exports=r},function(e,t,n){var r=n(43),i=n(51),o=n(61),s=o(function(e,t){return null==e?{}:i(e,r(t,1))});e.exports=s},function(e,t,n){function r(e,t,n){var r=u(e)?i:a,c=arguments.length<3;return r(e,s(t,4),n,c,o)}var i=n(52),o=n(90),s=n(95),a=n(151),u=n(2);e.exports=r},function(e,t){function n(e,t,n,r,i){return i(e,function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)}),n}e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){var t,n;return new a["default"]({defaults:(t={},i(t,f,"yes"),i(t,d,"no"),i(t,h,"no"),i(t,p,"yes"),i(t,_,"no"),i(t,v,"http:"),i(t,g,"no"),i(t,y,"no"),i(t,m,"no"),i(t,E,"off"),i(t,k,"no"),t),deviceID:e.deviceID,overrides:(n={},i(n,y,w(b)),i(n,E,w("v2")),i(n,_,w("yes")),i(n,h,w("yes")),i(n,g,w("yes")),n),platform:"web",login:e.login,provider:new c["default"](c["default"].SERVICE_URL),Promise:Promise})}Object.defineProperty(t,"__esModule",{value:!0}),t.USE_LANTERN=t.CAPTIONS=t.CLIPS_EXPERIMENT_ENABLED=t.CLIPS=t.HTML5_TOGGLE=t.THUMBNAIL_PREVIEWS=t.USHER_PROTOCOL=t.MARKERS=t.PREROLL_ADS=t.ABS_V2=t.NETWORK_PROFILE_COLLECTION=t.ENABLE_REPEAT_ADS=void 0,t.createClient=o;var s=n(153),a=r(s),u=n(161),c=r(u),l=n(147),f=t.ENABLE_REPEAT_ADS="c3e8c522-b537-47e6-9920-743360618b4a",d=t.NETWORK_PROFILE_COLLECTION="5fbb67a0-b4ff-4775-b836-e9a348a87481",h=t.ABS_V2="c5824f4a-ecb8-4ef1-9d49-18885bf8bba5",p=t.PREROLL_ADS="4e61c5c6-8cfb-485e-87f1-fc21c0d03068",_=t.MARKERS="f725b4b2-bd4c-4cc9-a354-d0db1e762955",v=t.USHER_PROTOCOL="fc2b4b0b-32dd-4e55-8e73-d87b9985a70e",g=t.THUMBNAIL_PREVIEWS="ad39c35b-c6af-4687-b791-9ab408f825ef",m=t.HTML5_TOGGLE="865ce2f3-52be-4a8c-87fe-d8ad580f4679",y=t.CLIPS="b4d61bdb-c174-47e6-a2f9-a46a4088ac26",b=t.CLIPS_EXPERIMENT_ENABLED="yes",E=t.CAPTIONS="4afcc1d7-b6f4-489a-beb3-0a32eb780592",k=t.USE_LANTERN="c0168c60-b0f7-4766-aac6-b6edf7555302",w=function(e){return(0,l.krakenUserInfo)().then(function(t){return t.staff?e:Promise.reject()})}},function(e,t,n){function r(e){var t=i(e);if(null!==t)throw t;this._config=o(e),this._Promise=e.Promise,this._deviceID=e.deviceID,this._platform=e.platform,this._username=e.login||null,this._defaults=s(e.Promise,e.defaults,e.overrides||{}),this._assignments=a(e.Promise,this._config,this._defaults,e.overrides||{},this._deviceID)}function i(e){return e.defaults&&Object.getPrototypeOf(e.defaults)===Object.prototype?"string"!=typeof e.deviceID||0===e.deviceID.length?new Error("Invalid device ID; expected non-empty string, got `"+e.deviceID+"`"):"string"!=typeof e.platform||0===e.platform.length?new Error("Invalid platform; expected non-empty string, got `"+e.platform+"`"):"object"!=typeof e.provider||"function"!=typeof e.provider.getExperimentConfiguration?new Error("Invalid provider"):"function"!=typeof e.Promise?new Error("Invalid Promise implementation"):null:new Error("Invalid defaults; expected object, got "+JSON.stringify(e.defaults))}function o(e){return new e.Promise(function(t,n){e.provider.getExperimentConfiguration(t,n)}).then(function(e){var t=c.validate(e);if(t)throw t;return e})}function s(e,t,n){var r={};for(var i in t)r[i]=function(r){return e.resolve(n[i]).then(function(e){return"string"==typeof e?e:t[r]},function(){return t[r]})}(i);return r}function a(e,t,n,r,i){var o={};for(var s in n)n.hasOwnProperty(s)&&(o[s]=function(o){return t.then(function(e){if(!e.hasOwnProperty(o))throw new Error("Experiment `"+o+"` is deprecated");return c.selectTreatment(o,e[o],i)},function(e){return n[o]}).then(function(t){return e.resolve(r[o]).then(function(e){return"string"==typeof e?e:t},function(){return t})})}(s));return o}function u(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);
for(n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(r[n]=t[n]);return r}var c=n(154),l=n(157);e.exports=r,r.prototype.get=function(e,t){var n=u(t||{},{mustTrack:!1}),r=this._assignments[e]||this._Promise.reject(new Error("No experiment with ID `"+e+"`")),i=this._Promise.all([this._config,r]).then(function(t){var n=t[0],r=t[1],i={client_time:(new Date).getTime()/1e3,device_id:this._deviceID,experiment_id:n[e].name,experiment_group:r,platform:this._platform};null!==this._username&&(i.login=this._username);var o=new this._Promise(function(e,t){l.sendEvent("experiment_branch",i,e)}).then(null,function(){return null});return o}.bind(this));return this._Promise.all([r,n.mustTrack?i:null]).then(function(e){return e[0]},function(t){return console.warn(t),this._defaults[e]||null}.bind(this))}},function(e,t,n){function r(e,t,n){this.name="InvalidExperimentConfigurationError",this.message='Invalid configuration for experiment "'+e+'": '+n,this.stack=(new Error).stack}function i(e,t){if(!t.hasOwnProperty("groups"))return new r(e,t,"missing a `groups` property");if(0===t.groups.length)return new r(e,t,"`groups` has no members");var n,i;for(n=0;n<t.groups.length;n++)if(t.groups[n].hasOwnProperty("value")?t.groups[n].hasOwnProperty("weight")?t.groups[n].weight!==Math.floor(t.groups[n].weight)?i="has a non-integer weight":t.groups[n].weight<0&&(i="has a negative weight"):i="is missing a `weight` property":i="is missing a `value` property",i)return new r(e,t,"Group "+t.groups[n].value+" "+i);return null}var o=n(155);t.validate=function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=i(t,e[t]);if(null!==n)return n}return null},t.selectTreatment=function(e,t,n){var r=e+n,i=o(r),s=i.words[0]>>>0,a=s/Math.pow(2,32),u=t.groups.reduce(function(e,t){return e+t.weight},0);return t.groups.reduce(function(e,t){return null===e.value&&(e.current-=t.weight/u,e.current<=0&&(e.value=t.value)),e},{value:null,current:a}).value}},function(e,t,n){!function(r,i){e.exports=t=i(n(156))}(this,function(e){return function(){var t=e,n=t.lib,r=n.WordArray,i=n.Hasher,o=t.algo,s=[],a=o.SHA1=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],c=0;80>c;c++){if(16>c)s[c]=0|e[t+c];else{var l=s[c-3]^s[c-8]^s[c-14]^s[c-16];s[c]=l<<1|l>>>31}var f=(r<<5|r>>>27)+u+s[c];f+=20>c?(i&o|~i&a)+1518500249:40>c?(i^o^a)+1859775393:60>c?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,u=a,a=o,o=i<<30|i>>>2,i=r,r=f}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),t[(r+64>>>9<<4)+15]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=i._createHelper(a),t.HmacSHA1=i._createHmacHelper(a)}(),e.SHA1})},function(e,t,n){!function(n,r){e.exports=t=r()}(this,function(){var e=e||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),o=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],n!=t?this.sigBytes=n:this.sigBytes=4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;i>o;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var o=0;i>o;o+=4)t[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],i=function(t){var t=t,n=987654321,r=4294967295;return function(){n=36969*(65535&n)+(n>>16)&r,t=18e3*(65535&t)+(t>>16)&r;var i=(n<<16)+t&r;return i/=4294967296,i+=.5,i*(e.random()>.5?1:-1)}},s=0;t>s;s+=4){var a=i(4294967296*(n||e.random()));n=987654071*a(),r.push(4294967296*a()|0)}return new o.init(r,t)}}),s=n.enc={},a=s.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;n>i;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},u=s.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;n>i;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,a=4*s,u=i/a;u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0);var c=u*s,l=e.min(4*c,i);if(c){for(var f=0;c>f;f+=s)this._doProcessBlock(r,f);var d=r.splice(0,c);n.sigBytes-=l}return new o.init(d,l)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(r.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}}),n.algo={});return n}(Math);return e})},function(e,t,n){var r=n(158),i=n(159),o=n(160);t.SPADE_URL="//spade.twitch.tv/",t.sendEvent=function(e,n,s){var a={event:e,properties:n},u=r.stringify(i.parse(JSON.stringify(a)));o.fetch(t.SPADE_URL+"?data="+encodeURIComponent(u),{},s)}},function(e,t,n){!function(r,i){e.exports=t=i(n(156))}(this,function(e){return function(){var t=e,n=t.lib,r=n.WordArray,i=t.enc;i.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;n>o;o+=3)for(var s=t[o>>>2]>>>24-o%4*8&255,a=t[o+1>>>2]>>>24-(o+1)%4*8&255,u=t[o+2>>>2]>>>24-(o+2)%4*8&255,c=s<<16|a<<8|u,l=0;4>l&&n>o+.75*l;l++)i.push(r.charAt(c>>>6*(3-l)&63));var f=r.charAt(64);if(f)for(;i.length%4;)i.push(f);return i.join("")},parse:function(e){var t=e.length,n=this._map,i=n.charAt(64);if(i){var o=e.indexOf(i);-1!=o&&(t=o)}for(var s=[],a=0,u=0;t>u;u++)if(u%4){var c=n.indexOf(e.charAt(u-1))<<u%4*2,l=n.indexOf(e.charAt(u))>>>6-u%4*2,f=c|l;s[a>>>2]|=f<<24-a%4*8,a++}return r.create(s,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64})},function(e,t,n){!function(r,i){e.exports=t=i(n(156))}(this,function(e){return e.enc.Utf8})},function(e,t){function n(e,t){var n=document.head||document.getElementsByTagName("head")[0];n||t(new Error("No head element to append script"));var r=document.createElement("script");r.onload=function(){t(null),setTimeout(function(){n.removeChild(r)},0)},r.onerror=function(){t(new Error("Unable to load script"))},n.appendChild(r),r.src=e}function r(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){switch(n.readyState){case i:return void(200<=n.status&&n.status<300?t(null,n.responseText):t(new Error("XHR error: "+n.status+" "+e),null))}},n.send()}var i=4;t.fetch=function(e,t,i){t.injectScript?n(e,i||function(){}):r(e,i||function(){})}},function(e,t,n){function r(e){this._url=e}var i=n(160);e.exports=r,r.SERVICE_URL="//minixperiment.twitch.tv/experiments.json",r.prototype.getExperimentConfiguration=function(e,t){i.fetch(this._url,{},function(n,r){if(null!==n)return void t(n);try{e(JSON.parse(r))}catch(i){t(new Error("Invalid JSON response from server: "+r))}})}},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CAST_SENDER_URL=t.BackendChromecast=void 0;var o=n(76),s=i(o),a=n(163),u=n(66),c=r(u),l=n(147),f=n(164),d=r(f),h=n(165),p=r(h),_=n(166),v=r(_),g=t.BackendChromecast={},m=t.CAST_SENDER_URL="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js",y=5;!function(){function e(){var e=new a.Deferred,t=function(){if(window.chrome)if(chrome.cast&&chrome.cast.isAvailable)e.resolve(!0);else{window.__onGCastApiAvailable=function(t){e.resolve(t)};var t=y,n=setInterval(function(){var r=(chrome.cast&&chrome.cast.isAvailable,!1);(r||0>=t)&&(e.resolve(r),clearInterval(n)),t--},1e3)}else e.resolve(!1)};return $.ajax({url:m,dataType:"script",cache:!0,success:t}),e.promise}function t(e){if(e){var t=new chrome.cast.SessionRequest(c.chromecastId),n=new chrome.cast.ApiConfig(t,r,o,chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED);chrome.cast.initialize(n)}}function n(){P=!1,b()}function r(e){T=e,T.addUpdateListener(i),A&&N&&h()}function i(){if(T.status===chrome.cast.SessionStatus.CONNECTED){var e=T.receiver;return S.volume!==e.volume.level&&(S.volume=e.volume.level,w.emit(d.VOLUME_CHANGE)),void(S.muted!==e.volume.muted&&(S.muted=e.volume.muted,w.emit(d.VOLUME_CHANGE)))}return T.status===chrome.cast.SessionStatus.STOPPED?(u(null),T.removeUpdateListener(i),T=null,I=!1,void b()):void(T.status===chrome.cast.SessionStatus.DISCONNECTED)}function o(e){P=e===chrome.cast.ReceiverAvailability.AVAILABLE,b()}function u(e){O&&O.removeUpdateListener(f),O=e,I=!1,b(),O&&O.addUpdateListener(f)}function f(){S.currentTime!==O.currentTime&&(S.currentTime=O.currentTime,w.emit(d.TIME_UPDATE)),S.volume!==O.volume.level&&(S.volume=O.volume.level,w.emit(d.VOLUME_CHANGE)),S.muted!==O.volume.muted&&(S.muted=O.volume.muted,w.emit(d.VOLUME_CHANGE)),S.playbackRate!==O.playbackRate&&(S.playbackRate=O.playbackRate,w.emit(d.RATE_CHANGE));var e=O.playerState;S.playerState!==O.playerState&&(e===chrome.cast.media.PlayerState.PLAYING?w.emit(d.PLAYING):e===chrome.cast.media.PlayerState.PAUSED?w.emit(d.PAUSE):e===chrome.cast.media.PlayerState.BUFFERING,S.playerState=O.playerState)}function h(){I=!0,b();var e=(0,l.channelInfo)(A);e.then(function(e){(0,l.offlinePlaylistInfo)(e._id).then(function(t){var n=t||{},r=new chrome.cast.media.MediaInfo(N,"application/x-mpegurl");r.streamType=chrome.cast.media.StreamType.LIVE;var i=new chrome.cast.media.GenericMediaMetadata;i.subtitle=e.game,i.title=e.display_name,i.images=[new chrome.cast.Image(e.logo)],r.metadata=i,r.customData={channel:A,is_spectre:Boolean(n.active)};var o=new chrome.cast.media.LoadRequest(r);o.autoplay=!0,T.loadMedia(o,u)})},function(e){T.stop(),_(e)})}function _(e){e&&(R=e,w.emit(d.ERROR))}function b(){var e=M,t=C;O?(M=p.NETWORK_LOADING,C=v.HAVE_METADATA,w.emit(d.CAN_PLAY)):I?(M=p.NETWORK_LOADING,C=v.HAVE_NOTHING):P&&A?(M=p.NETWORK_IDLE,C=v.HAVE_NOTHING):(M=p.NETWORK_EMPTY,C=v.HAVE_NOTHING),M!==e&&(M===p.NETWORK_LOADING?(w.emit(d.LOADSTART),w.emit(d.PROGRESS)):M===p.NETWORK_IDLE?w.emit(d.SUSPEND):M===p.NETWORK_EMPTY&&w.emit(d.EMPTIED)),C!==t&&(C===v.HAVE_METADATA?w.emit(d.LOADED_METADATA):C===v.HAVE_NOTHING&&w.emit(d.ENDED))}function E(e){_(e)}var k=g,w=new s["default"],S={},T=void 0,O=void 0,A=void 0,P=void 0,R=void 0,I=void 0,M=void 0,C=void 0,L=!1,N=null;k.init=function(){if(w.removeAllListeners(),!L){L=!0,n();var r=e();r.then(t)}},k.destroy=function(){},k.addEventListener=function(e,t){w.on(e,t)},k.removeEventListener=function(e,t){w.off(e,t)},k.getNetworkProfile=function(){return[]},k.getError=function(){return R},k.getSrc=function(){},k.setSrc=function(){},k.getCurrentSrc=function(){},k.getNetworkState=function(){return M},k.getPreload=function(){},k.setPreload=function(){},k.load=function(){chrome.cast.requestSession(r,E)},k.getBuffered=function(){return{length:0}},k.getReadyState=function(){return C},k.getSeeking=function(){},k.getCurrentTime=function(){return O?O.getEstimatedTime():void 0},k.setCurrentTime=function(e){if(O){var t=new chrome.cast.media.SeekRequest;t.time=e,O.seek(t)}},k.getInitialTime=function(){},k.getDuration=function(){},k.getStartOffsetTime=function(){},k.getPaused=function(){return O?O.playerState===chrome.cast.media.PlayerState.PAUSED:void 0},k.getDefaultPlaybackRate=function(){},k.setDefaultPlaybackRate=function(){},k.getPlaybackRate=function(){},k.setPlaybackRate=function(){},k.getPlayed=function(){},k.getSeekable=function(){},k.getEnded=function(){},k.getAutoplay=function(){},k.setAutoplay=function(){},k.getLoop=function(){},k.setLoop=function(){},k.play=function(){if(O){var e=new chrome.cast.media.PlayRequest;O.play(e)}else k.load()},k.pause=function(){if(O){var e=new chrome.cast.media.PauseRequest;O.pause(e)}},k.getControls=function(){},k.setControls=function(){},k.getVolume=function(){return O?O.volume.level:void 0},k.setVolume=function(e){if(O){var t=new chrome.cast.Volume(e,null),n=new chrome.cast.media.VolumeRequest(t);O.setVolume(n)}},k.getMuted=function(){return O?O.volume.muted:T?T.receiver.volume.muted:void 0},k.setMuted=function(e){if(O){var t=new chrome.cast.Volume(null,e),n=new chrome.cast.media.VolumeRequest(t);O.setVolume(n)}},k.getDefaultMuted=function(){},k.setDefaultMuted=function(){},k.getQuality=function(){return"auto"},k.setQuality=function(){},k.getQualities=function(){return["auto"]},k.getChannel=function(){return A},k.setChannel=function(e,t){A=e,t.streamUrl.then(function(e){N=e,T&&A&&N&&h()})},k.getVideo=function(){return null},k.setVideo=function(){A=null,N=null},k.getStats=function(){},k.getStatsEnabled=function(){},k.setStatsEnabled=function(){},k.getVideoInfo=function(){},k.getCaption=function(){},k.getBackend=function(){return"chromecast"},k.stop=function(){T&&T.stop()},k.getDevice=function(){return T&&T.receiver?T.receiver.friendlyName:void 0}}()},function(e,t){"use strict";function n(){var e=this;e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})}Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LOADSTART="loadstart",t.PROGRESS="progress",t.SUSPEND="suspend",t.ABORT="abort",t.ERROR="error",t.EMPTIED="emptied",t.STALLED="stalled",t.LOADED_METADATA="loadedmetadata",t.LOADED_DATA="loadeddata",t.CAN_PLAY="canplay",t.PLAYING="playing",t.WAITING="waiting",t.SEEKING="seeking",t.SEEKED="seeked",t.ENDED="ended",t.DURATION_CHANGE="durationchange",t.TIME_UPDATE="timeupdate",t.PLAY="play",t.PAUSE="pause",t.RESIZE="resize",t.VOLUME_CHANGE="volumechange",t.RATE_CHANGE="ratechange"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NETWORK_EMPTY=0,t.NETWORK_IDLE=1,t.NETWORK_LOADING=2,t.NETWORK_NO_SOURCE=3},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HAVE_NOTHING=0,t.HAVE_METADATA=1,t.HAVE_CURRENT_DATA=2,t.HAVE_FUTURE_DATA=3,t.HAVE_ENOUGH_DATA=4},function(e,t,n){var r,i,o;(function(n){"use strict";!function(n,s){i=[],r=s,o="function"==typeof r?r.apply(t,i):r,!(void 0!==o&&(e.exports=o))}(this,function(){function e(){try{return s in i&&i[s]}catch(e){return!1}}var t,r={},i="undefined"!=typeof window?window:n,o=i.document,s="localStorage",a="script";if(r.disabled=!1,r.version="1.3.20",r.set=function(e,t){},r.get=function(e,t){},r.has=function(e){return void 0!==r.get(e)},r.remove=function(e){},r.clear=function(){},r.transact=function(e,t,n){null==n&&(n=t,t=null),null==t&&(t={});var i=r.get(e,t);n(i),r.set(e,i)},r.getAll=function(){},r.forEach=function(){},r.serialize=function(e){return JSON.stringify(e)},r.deserialize=function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e||void 0}},e())t=i[s],r.set=function(e,n){return void 0===n?r.remove(e):(t.setItem(e,r.serialize(n)),n)},r.get=function(e,n){var i=r.deserialize(t.getItem(e));return void 0===i?n:i},r.remove=function(e){t.removeItem(e)},r.clear=function(){t.clear()},r.getAll=function(){var e={};return r.forEach(function(t,n){e[t]=n}),e},r.forEach=function(e){for(var n=0;n<t.length;n++){var i=t.key(n);e(i,r.get(i))}};else if(o&&o.documentElement.addBehavior){var u,c;try{c=new ActiveXObject("htmlfile"),c.open(),c.write("<"+a+">document.w=window</"+a+'><iframe src="/favicon.ico"></iframe>'),c.close(),u=c.w.frames[0].document,t=u.createElement("div")}catch(l){t=o.createElement("div"),u=o.body}var f=function(e){return function(){var n=Array.prototype.slice.call(arguments,0);n.unshift(t),u.appendChild(t),t.addBehavior("#default#userData"),t.load(s);var i=e.apply(r,n);return u.removeChild(t),i}},d=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),h=function(e){return e.replace(/^d/,"___$&").replace(d,"___")};r.set=f(function(e,t,n){return t=h(t),void 0===n?r.remove(t):(e.setAttribute(t,r.serialize(n)),e.save(s),n)}),r.get=f(function(e,t,n){t=h(t);var i=r.deserialize(e.getAttribute(t));return void 0===i?n:i}),r.remove=f(function(e,t){t=h(t),e.removeAttribute(t),e.save(s)}),r.clear=f(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(s);for(var n=t.length-1;n>=0;n--)e.removeAttribute(t[n].name);e.save(s)}),r.getAll=function(e){var t={};return r.forEach(function(e,n){t[e]=n}),t},r.forEach=f(function(e,t){for(var n,i=e.XMLDocument.documentElement.attributes,o=0;n=i[o];++o)t(n.name,r.deserialize(e.getAttribute(n.name)))})}try{var p="__storejs__";r.set(p,p),r.get(p)!=p&&(r.disabled=!0),r.remove(p)}catch(l){r.disabled=!0}return r.enabled=!r.disabled,r})}).call(t,function(){return this}())},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};t["default"]=n,function(){var e=n;e.key=function(e){return sessionStorage.key(e)},e.getItem=function(e){var t=sessionStorage.getItem(e);if(t)return JSON.parse(t)},e.setItem=function(e,t){var n=JSON.stringify(t);sessionStorage.setItem(e,n)},e.removeItem=function(e){sessionStorage.removeItem(e)},e.clear=function(){sessionStorage.clear()},Object.defineProperty(e,"length",{get:function(){return sessionStorage.length}})}()},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.PubSub=t.AVAILABLE_EVENTS=t.EVENT_TOS=t.EVENT_OFFLINE=t.EVENT_ONLINE=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(79),u=i(a),c=n(76),l=i(c),f=n(170),d=i(f),h=n(66),p=r(h),_=n(181),v=n(182),g=n(183),m=n(184),y=n(147),b=t.EVENT_ONLINE="online",E=t.EVENT_OFFLINE="offline",k=t.EVENT_TOS="tos",w=t.AVAILABLE_EVENTS=[b,E,k];t.PubSub=function(){function e(t){var n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o(this,e),this._eventEmitter=new l["default"],this._debugMode=r.debug,this._onMessage=function(e){n.onPubSubMessage(e)},this._stateStore=t,this._pubSub=d["default"].getInstance(p.pubSubEnviroment),this._handleStreamUpdate(this._stateStore.getState().stream),this._unsubscribe=this._subscribe()}return s(e,[{key:"onPubSubMessage",value:function(e){var t=this;try{var n=JSON.parse(e);switch(this._debugMode&&console.info("PubSub: "+JSON.stringify(n)),n.type){case"stream-up":this._stateStore.dispatch((0,g.setOnline)(!0)),this._eventEmitter.emit(b),y.streamInfo.cache.clear(),(0,y.streamInfo)(this._stateStore.getState().stream.channel).then(function(e){t._stateStore.dispatch((0,v.updateViewerCount)(e.stream.viewers))});break;case"stream-down":this._stateStore.dispatch((0,g.setOnline)(!1)),this._eventEmitter.emit(E);break;case"viewcount":this._stateStore.dispatch((0,v.updateViewerCount)(n.viewers));break;case"tos-strike":this._eventEmitter.emit(k);break;default:this._debugMode&&console.warn("PubSub: Invalid message - "+JSON.stringify(n))}}catch(r){console.error("Failed to parse Pubsub message as JSON: "+e)}}},{key:"_subscribe",value:function(){var e=this;return(0,_.subscribe)(this._stateStore,["stream"],function(t,n){e._unlisten(n.stream.channel),e._handleStreamUpdate(t.stream)})}},{key:"_handleStreamUpdate",value:function(e){e.contentType===m.CONTENT_MODE_LIVE&&this._listen(e.channel)}},{key:"_listen",value:function(e){var t=this;this._pubSub.Listen({topic:"video-playback."+e,success:function(){t._debugMode&&console.info("PubSub: successfully listened to video-playback."+e)},failure:function(e){console.error("PubSub: error listening: "+e)},message:this._onMessage})}},{key:"_unlisten",value:function(e){var t=this;this._pubSub.Unlisten({topic:"video-playback."+e,success:function(){t._debugMode&&console.info("PubSub: successfully unlistened to video-playback."+e)},failure:function(e){console.error("PubSub: error unlistening: %o",e)},message:this._onMessage})}},{key:"addEventListener",value:function(e,t){(0,u["default"])(w,e)&&this._eventEmitter.addListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._eventEmitter.removeListener(e,t)}},{key:"destroy",value:function(){this._unsubscribe(),this._stateStore.getState().stream.contentType===m.CONTENT_MODE_LIVE&&this._unlisten(this._stateStore.getState().stream.channel)}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){if("production"!==e&&"staging"!==e&&"darklaunch"!==e)throw"Invalid Pubsub instance environment";return null===window.__Twitch__pubsubInstances[e]&&(window.__Twitch__pubsubInstances[e]=new P(e)),window.__Twitch__pubsubInstances[e]}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(171),l=r(c),f=n(172),d=r(f),h=n(173),p=r(h),_=n(174),v=r(_),g=n(176),m=r(g),y=n(177),b=r(y),E=n(179),k=r(E),w=n(180),S=r(w),T=d["default"]._getLogger("PubsubDriver"),O=/^https?:\/\/([\w-]+\.)*twitch\.tv(:\d+)?\/.*$/,A=1,P=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n._env=p["default"].urlParams.pubsub_environment||e,n._clientReady=!1,n._queuedRequests=[],n._stats=new k["default"]({env:n._env}),n._numDisconnects=0,p["default"].inIframe()&&O.test(document.referrer)?(T.debug("Driver is in an iframe"),n._client=new v["default"]({parentUrl:document.referrer}),n._clientType="iframe-verified"):(T.debug("Driver is not in an iframe"),n._client=new b["default"]({env:n._env,stats:n._stats}),n._iframeHost=new m["default"](n._client),n._clientType="ws"),"true"===p["default"].urlParams.force_pubsub_tester?A=1:"false"===p["default"].urlParams.force_pubsub_tester&&(A=0),Math.random()<A&&(n._tester=new S["default"]({env:n._env,driver:n,stats:n._stats})),n._client.on("unverified",n._clientUnverified,n),n._client.on("verified",n._clientVerified,n),n._client.verify(),n}return s(t,e),u(t,[{key:"connect",value:function(){}},{key:"Listen",value:function(e){this._clientReady?this._client.Listen(e):this._queuedRequests.push({type:"LISTEN",opts:e})}},{key:"Unlisten",value:function(e){this._clientReady?this._client.Unlisten(e):this._queuedRequests.push({type:"UNLISTEN",opts:e})}},{key:"_flushQueuedRequests",value:function(){for(T.debug("Flushing "+this._queuedRequests.length+" queued requests");this._queuedRequests.length>0;){var e=this._queuedRequests.shift();switch(e.type){case"LISTEN":this._client.Listen(e.opts);break;case"UNLISTEN":this._client.Unlisten(e.opts)}}}},{key:"_clientConnected",value:function(){T.debug("Client connected"),this._client.on("disconnected",this._clientDisconnected,this),this._stats.sendStatCounter("connected",1),this._trigger("connected"),this._clientReady=!0,this._flushQueuedRequests()}},{key:"_clientDisconnected",value:function(){T.debug("Client disconnected"),this._trigger("disconnected"),this._clientReady=!1,this._numDisconnects+=1}},{key:"_clientVerified",value:function(){T.debug("Client verified (type = "+this._clientType+")"),this._stats.setPrefix("pubsub-js-client."+this._clientType+"."),this._client.on("connected",this._clientConnected,this),this._client.connect(),window.setInterval(this._sendClientTypeGauge.bind(this),6e4)}},{key:"_clientUnverified",value:function(){T.debug("Unverified IframeClient"),this._client.off("verified",this._clientVerified,this),this._client.off("unverified",this._clientUnverified,this),this._client=new b["default"]({env:this._env,stats:this._stats}),this._clientType="iframe-unverified",this._client.on("unverified",this._clientUnverified,this),this._client.on("verified",this._clientVerified,this),this._client.verify()}},{key:"_sendClientTypeGauge",value:function(){this._stats.sendStatGauge("pubsub-js-client."+this._clientType)}}]),t}(l["default"]);window.__Twitch__pubsubInstances=window.__Twitch__pubsubInstances||{production:null,staging:null,darklaunch:null},t["default"]={getInstance:a}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,[{key:"on",value:function(e,t,n){return this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t,n),this}},{key:"off",value:function(e,t){if(this._events)for(var n=this._events[e]||[],r=this._events[e]=[],i=0;i<n.length;i+=2)n[i]!==t&&(r.push(n[i]),r.push(n[i+1]));return this}},{key:"_trigger",value:function(e){if(this._events)for(var t=this._events[e]||[],n=1;n<t.length;n+=2)t[n-1].apply(t[n],Array.prototype.slice.call(arguments,1));return this}},{key:"count",value:function(e){if(this._events){var t=this._events[e]||[];return t.length/2}return 0}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(173),a=r(s),u=function(){},c=u,l={},f={DEBUG:1,INFO:2,WARNING:3,ERROR:4,CRITICAL:5},d=f.WARNING,h=function(){function e(t){i(this,e),this._opts=t}return o(e,[{key:"debug",value:function(e){d<=f.DEBUG&&this._log("DEBUG: "+e)}},{key:"info",value:function(e){d<=f.INFO&&this._log("INFO: "+e)}},{key:"warning",value:function(e){d<=f.WARNING&&this._log("WARNING: "+e)}},{key:"error",value:function(e){d<=f.ERROR&&this._log("ERROR: "+e)}},{key:"critical",value:function(e){d<=f.CRITICAL&&this._log("CRITICAL: "+e)}},{key:"_log",value:function(e){var t=this._opts.prefix+e;this._opts.logFunc?this._opts.logFunc(t):c(t)}}]),e}(),p={setLogger:function(e){c="function"==typeof e?e:u},setLevel:function(){var e=(a["default"].urlParams.pubsub_log_level||"").toUpperCase();if(e){var t=f[e];if(t)return d=t,function(){}}return function(e){d=e?f[e.toUpperCase()]||f.WARNING:f.WARNING}}(),_getLogger:function(e){return l[e]||(l[e]=new h({prefix:"pubsub.js ["+e+"] "})),l[e]},_noopLogger:new h({prefix:"",logFunc:u})},_=window.console;_&&_.log&&(_.log.apply?p.setLogger(function(){_.log.apply(_,arguments)}):p.setLogger(function(){for(var e=[],t=0;t<arguments.length;++t)e.push(arguments[t]);_.log(e.join(" "))})),t["default"]=p},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};n.randomInt=function(e){return Math.floor(Math.random()*e)},n.time={seconds:function(e){return 1e3*e},now:function(){return(new Date).getTime()}},n.urlParams=function(){for(var e={},t=window.location.search.substr(1),n=t.split("&"),r=0;r<n.length;++r){var i=n[r].split("=");e[decodeURIComponent(i[0])]=i.length>1?decodeURIComponent(i[1]):""}return e}(),n.generateString=function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;e>i;i++)t+=r.charAt(n.randomInt(r.length));return t},n.inIframe=function(){try{return window.self!==window.top}catch(e){return!0}},t["default"]=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(171),c=r(u),l=n(172),f=r(l),d=n(173),h=r(d),p=n(175),_=r(p),v=30,g=3e4,m=1e3,y="pubsub",b=f["default"]._getLogger("IframeClient"),E=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n._parentUrl=e.parentUrl,n._pendingResponses=new _["default"],n._listens=new c["default"],window.addEventListener("message",n.receiveMessage.bind(n),!1),n}return s(t,e),a(t,[{key:"connect",value:function(){window.parent.postMessage({twitch_protocol:y,type:"connect"},this._parentUrl)}},{key:"verify",value:function(){window.parent.postMessage({twitch_protocol:y,type:"verify"},this._parentUrl),this._verifyTimeout=setTimeout(this._unverified.bind(this),m)}},{key:"Listen",value:function(e){b.debug("listening on "+e.topic);var t=this._generateNonce(),n={twitch_protocol:y,type:"LISTEN",nonce:t,data:{topics:[e.topic],auth_token:e.auth}};this._send(t,n,e)}},{key:"Unlisten",value:function(e){if(b.debug("unlistening on "+e.topic+"("+this._listens.count(e.topic)+" listeners)"),this._listens.count(e.topic)>1)return this._listens.off(e.topic,e.message),e.success(),void b.debug("now have "+this._listens.count(e.topic)+" listeners");
var t=this._generateNonce(),n={twitch_protocol:y,type:"UNLISTEN",nonce:t,data:{topics:[e.topic]}};this._send(t,n,e)}},{key:"_send",value:function(e,t,n){this._pendingResponses.set(e,{timeout:setTimeout(this._onResponseTimeout.bind(this),g,e),topic:n.topic,auth:n.auth,message:t,callbacks:{success:n.success,failure:n.failure,message:n.message}}),window.parent.postMessage(t,this._parentUrl)}},{key:"receiveMessage",value:function(e){if(e.data.twitch_protocol==y)switch(b.debug("Received message: "+JSON.stringify(e.data)),e.data.type){case"connected":this._trigger("connected");break;case"disconnected":this._trigger("disconnected");break;case"success":this.handleResponse(!0,e.data);break;case"failure":this.handleResponse(!1,e.data);break;case"message":this.handleMessage(e.data.topic,e.data.message);break;case"verify":this._verified()}}},{key:"handleResponse",value:function(e,t){if(this._pendingResponses.has(t.nonce)){var n=this._pendingResponses.get(t.nonce);b.debug("ResponseInfo: "+JSON.stringify(n)),clearTimeout(n.timeout),this._pendingResponses.remove(t.nonce),e?("LISTEN"===n.message.type?this._listens.on(n.topic,n.callbacks.message,this):"UNLISTEN"===n.message.type&&this._listens.off(n.topic,n.callbacks.message,this),n.callbacks.success()):n.callbacks.failure(t.error)}}},{key:"handleMessage",value:function(e,t){b.debug("received '"+t+"' on topic "+e),this._listens._trigger(e,t)}},{key:"_onResponseTimeout",value:function(e){b.debug("response timed out: "+e)}},{key:"_verified",value:function(){b.debug("Verified"),clearTimeout(this._verifyTimeout),this._trigger("verified")}},{key:"_unverified",value:function(){window.removeEventListener("message",this.receiveMessage.bind(this),!1),this._trigger("unverified")}},{key:"_generateNonce",value:function(){return h["default"].generateString(v)}}]),t}(c["default"]);t["default"]=E},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e),this._map={},this._size=0}return r(e,[{key:"set",value:function(e,t){this._map.hasOwnProperty(e)||(this._size+=1),this._map[e]=t}},{key:"get",value:function(e){return this._map[e]}},{key:"has",value:function(e){return this._map.hasOwnProperty(e)}},{key:"remove",value:function(e){this._map.hasOwnProperty(e)&&(this._size-=1),delete this._map[e]}},{key:"size",value:function(){return this._size}},{key:"map",value:function(){return this._map}},{key:"values",value:function(){var e=[];for(var t in this._map)this._map.hasOwnProperty(t)&&e.push(this._map[t]);return e}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(172),a=r(s),u="pubsub",c=a["default"]._getLogger("IframeHost"),l=function(){function e(t){i(this,e),this._driver=t,this._sources=[],this._driver.on("connected",this.handleConnected,this),this._driver.on("disconnected",this.handleDisconnected,this),window.addEventListener("message",this.receiveMessage.bind(this),!1)}return o(e,[{key:"receiveMessage",value:function(e){if(e.data.twitch_protocol==u)switch(c.debug("Received message: "+JSON.stringify(e.data)),e.data.type){case"LISTEN":this.handleListen(e.source,e.data.nonce,e.data.data);break;case"UNLISTEN":this.handleUnlisten(e.source,e.data.nonce,e.data.data);break;case"connect":this._sources.push(e.source),this._driver.connect();break;case"verify":e.source.postMessage({twitch_protocol:u,type:"verify"},"*")}}},{key:"handleListen",value:function(e,t,n){var r=function(){e.postMessage({twitch_protocol:u,type:"success",nonce:t},"*")},i=function(n){e.postMessage({twitch_protocol:u,type:"failure",nonce:t,error:n},"*")},o=function(t){e.postMessage({twitch_protocol:u,type:"message",topic:n.topics[0],message:t},"*")};this._driver.Listen({topic:n.topics[0],auth:n.auth_token,success:r,failure:i,message:o})}},{key:"handleUnlisten",value:function(e,t,n){var r=function(){e.postMessage({twitch_protocol:u,type:"success",nonce:t},"*")},i=function(n){e.postMessage({twitch_protocol:u,type:"failure",nonce:t,error:n},"*")},o=function(t){e.postMessage({twitch_protocol:u,type:"message",topic:n.topics[0],message:t},"*")};this._driver.Unlisten({topic:n.topics[0],auth:n.auth_token,success:r,failure:i,message:o})}},{key:"handleConnected",value:function(){for(var e=0;e<this._sources.length;e++)this._sources[e].postMessage({twitch_protocol:u,type:"connected"},"*")}},{key:"handleDisconnected",value:function(){for(var e=0;e<this._sources.length;e++)this._sources[e].postMessage({twitch_protocol:u,type:"disconnected"},"*")}}]),e}();t["default"]=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(171),c=r(u),l=n(172),f=r(l),d=n(173),h=r(d),p=n(178),_=r(p),v=n(175),g=r(v),m=f["default"]._getLogger("WebsocketClient"),y=3e4,b="response timeout",E=30,k=45e3,w="wss://pubsub-edge.twitch.tv:443/v1",S="wss://pubsub-edge-darklaunch.twitch.tv:443/v1",T="ws://localhost:6900/v1",O=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));switch(n._opts=e,n._env=e.env,n._stats=e.stats,n._env){case"production":n._addr=w;break;case"darklaunch":n._addr=S;break;case"development":n._addr=T;break;default:n._addr=w}return window.WebSocket?(n._queuedRequests=[],n._pendingResponses=new g["default"],n._pendingReplayResponses=new g["default"],n._listens=new c["default"],n._replays=new g["default"],n._replaysSize=0,n._firstConnectTime=n._firstListenTime=0,n._connectCalled=n._reconnecting=!1,n._primarySocket=new _["default"]({stats:n._stats,addr:n._addr}),n._bindPrimary(n._primarySocket),n):o(n)}return s(t,e),a(t,[{key:"verify",value:function(){this._trigger("verified")}},{key:"connect",value:function(){window.WebSocket&&(this._connectCalled?this._primarySocket._isReady()&&this._trigger("connected"):(this._connectCalled=!0,this._primarySocket.connect()))}},{key:"_bindPrimary",value:function(e){e.on("open",this._onPrimaryOpen,this),e.on("response",this._onResponse,this),e.on("message",this._onMessage,this),e.on("reconnect",this._onReconnect,this),e.on("connection_failure",this._onConnectionFailure,this)}},{key:"_unbindPrimary",value:function(e){e.off("open",this._onPrimaryOpen,this),e.off("response",this._onResponse,this),e.off("message",this._onMessage,this),e.off("reconnect",this._onReconnect,this),e.off("connection_failure",this._onConnectionFailure,this)}},{key:"_onPrimaryOpen",value:function(){m.debug("primary open: "+this._primarySocket._id),0===this._firstConnectTime&&(this._firstConnectTime=h["default"].time.now(),this._firstListenTimeout=setTimeout(this._neverListened.bind(this),k)),this._connected=!0,this._trigger("connected"),this._flushQueuedRequests()}},{key:"_onResponse",value:function(e){if(m.debug("primary response: "+JSON.stringify(e)),this._pendingResponses.has(e.nonce)){var t=this._pendingResponses.get(e.nonce);m.debug("responseInfo: "+JSON.stringify(t)),clearTimeout(t.timeout),this._pendingResponses.remove(e.nonce),""===e.error?("LISTEN"===t.message.type?(0===this._firstListenTime&&(clearTimeout(this._firstListenTimeout),this._firstListenTime=h["default"].time.now(),this._stats.sendStatTimer("time_to_first_listen",this._firstListenTime-this._firstConnectTime,.1)),this._replays.set(e.nonce,{nonce:e.nonce,message:t.callbacks.message,topic:t.topic,auth:t.auth}),this._listens.on(t.topic,t.callbacks.message,this)):"UNLISTEN"===t.message.type&&(this._replays.remove(e.nonce),this._listens.off(t.topic,t.callbacks.message,this)),t.callbacks.success()):t.callbacks.failure(e.error)}}},{key:"_onResponseTimeout",value:function(e){if(this._pendingResponses.has(e)){var t=this._pendingResponses.get(e);this._pendingResponses.remove(e),t.opts.failure(b)}}},{key:"_onMessage",value:function(e){m.debug("primary message: "+JSON.stringify(e)),this._listens._trigger(e.data.topic,e.data.message)}},{key:"_onConnectionFailure",value:function(){m.debug("connection failure"),this._trigger("disconnected"),this._notifyWhenOpen=!0,this._onReconnect()}},{key:"_onReconnect",value:function(){m.debug("reconnecting..."),this._reconnecting=!0,this._backupSocket=new _["default"]({stats:this._stats,addr:this._addr}),this._bindBackup(this._backupSocket),setTimeout(this._backupSocket.connect.bind(this._backupSocket),this._jitteredReconnectDelay())}},{key:"_bindBackup",value:function(e){e.on("open",this._onBackupOpen,this),e.on("response",this._onBackupResponse,this)}},{key:"_unbindBackup",value:function(e){e.off("open",this._onBackupOpen,this),e.off("response",this._onBackupResponse,this)}},{key:"_onBackupOpen",value:function(){m.debug("Backup socket opened"),this._replays.size()>0?this._replayBackup():(this._swapSockets(),this._notifyWhenOpen&&(m.debug("triggering connected"),this._notifyWhenOpen=!1,this._trigger("connected")))}},{key:"_replayBackup",value:function(){for(var e=this._replays.values(),t=0;t<e.length;t++){var n={type:"LISTEN",nonce:this._generateNonce(),data:{topics:[e[t].topic],auth_token:e[t].auth}};this._pendingReplayResponses.set(n.nonce,!0),this._backupSocket.send(n)}}},{key:"_onBackupResponse",value:function(e){this._pendingReplayResponses.has(e.nonce)&&""===e.error&&(this._pendingReplayResponses.remove(e.nonce),0===this._pendingReplayResponses.size()&&(this._swapSockets(),this._notifyWhenOpen&&(m.debug("triggering connected"),this._notifyWhenOpen=!1,this._trigger("connected"))))}},{key:"_swapSockets",value:function(){m.debug("swapping primary "+this._primarySocket._id+" and backup "+this._backupSocket._id),this._unbindPrimary(this._primarySocket),this._unbindBackup(this._backupSocket),this._bindPrimary(this._backupSocket),this._primarySocket.close(),this._primarySocket=this._backupSocket,this._reconnecting=!1,this._flushQueuedRequests()}},{key:"Listen",value:function(e){if(window.WebSocket){m.debug("listening on "+e.topic);var t=this._generateNonce(),n={type:"LISTEN",nonce:t,data:{topics:[e.topic],auth_token:e.auth}};this._queuedSend(t,n,e)}}},{key:"Unlisten",value:function(e){if(window.WebSocket){if(m.debug("unlistening on "+e.topic+"("+this._listens.count(e.topic)+" listeners)"),this._listens.count(e.topic)>1){this._listens.off(e.topic,e.message);for(var t in this._replays.map())if(this._replays.get(t).message===e.message){this._replays.remove(t);break}return e.success(),void m.debug("now have "+this._listens.count(e.topic)+" listeners")}var n=this._generateNonce(),r={type:"UNLISTEN",nonce:n,data:{topics:[e.topic]}};this._queuedSend(n,r,e)}}},{key:"_queuedSend",value:function(e,t,n){this._reconnecting||this._primarySocket._isReady()===!1?(m.debug("queuing"),this._queuedRequests.push({nonce:e,msg:t,opts:n})):(m.debug("sending immediately"),this._send(e,t,n))}},{key:"_flushQueuedRequests",value:function(){for(m.debug("flushing "+this._queuedRequests.length+" listen/unlistens");this._queuedRequests.length>0;){var e=this._queuedRequests.shift();this._send(e.nonce,e.msg,e.opts)}}},{key:"_send",value:function(e,t,n){this._pendingResponses.set(e,{timeout:setTimeout(this._onResponseTimeout.bind(this),y,e),topic:n.topic,auth:n.auth,message:t,callbacks:{success:n.success,failure:n.failure,message:n.message}}),this._primarySocket.send(t)}},{key:"_neverListened",value:function(){this._stats.sendStatCounter("first_listen_timeout",1)}},{key:"_generateNonce",value:function(){return h["default"].generateString(E)}},{key:"_jitteredReconnectDelay",value:function(){return h["default"].randomInt(2e3)}}]),t}(c["default"]);t["default"]=O},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(171),c=r(u),l=n(172),f=r(l),d=n(173),h=r(d),p=n(179),_=(r(p),f["default"]._getLogger("PubsubSocket")),v=120,g="not_ready",m=3e4,y=24e4,b=1,E=.1,k=.1,w=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n._opts=e,n._addr=e.addr,n._stats=e.stats,n._connectionAttempts=0,n._sentPing=n._receivedPong=!1,n._id="["+h["default"].generateString(10)+"] ",window.addEventListener("beforeunload",n._beforeUnload.bind(n)),n}return s(t,e),a(t,[{key:"connect",value:function(){_.debug(this._id+"connecting to "+this._addr),this._connecting=!0,this._socketConnectTime=h["default"].time.now();try{this._socket=new WebSocket(this._addr),this._socket.onmessage=this._onMessage.bind(this),this._socket.onerror=this._onError.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onopen=this._onOpen.bind(this)}catch(e){this._stats.sendStatCounter("socket.error.security_err",b),this._trigger("connection_failure")}}},{key:"close",value:function(){_.debug(this._id+"closing"),this._closing=!0,this._clearTimeouts(),this._socket.close()}},{key:"send",value:function(e){_.debug(this._id+"sending "+JSON.stringify(e)),this._isReady()?this._socket.send(JSON.stringify(e)):this._trigger("error",g)}},{key:"_isReady",value:function(){return _.debug(this._id+"_isReady called"),this._socket?this._socket.readyState===WebSocket.OPEN:!1}},{key:"_onMessage",value:function(e){_.debug(this._id+"received message: "+e.data);try{var t=JSON.parse(e.data);switch(t.type){case"RESPONSE":this._trigger("response",t);break;case"MESSAGE":this._trigger("message",t);break;case"PONG":this._receivedPong=!0;break;case"RECONNECT":this._trigger("reconnect")}}catch(n){this._stats.sendStatLogger("onMessage JSON Parse error: "+n)}}},{key:"_onError",value:function(e){_.debug(this._id+"error: "+JSON.stringify(e))}},{key:"_onClose",value:function(e){if(_.debug(this._id+"onClose triggered with code "+e.code+"(closing = "+this._closing+", connecting = "+this._connecting+")"),this._clearTimeouts(),this._connecting){var t=Math.pow(2,this._connectionAttempts);t>v&&(t=v),_.debug(this._id+"reconnecting in "+t+" seconds"),this._connectionAttempts+=1,this._nextConnectionAttempt=setTimeout(this.connect.bind(this),1e3*t)}else if(this._closing)this._closed=!0,this._trigger("connection_failure");else{if(this._windowUnloading)return;_.debug(this._id+"unexpected close"),this._stats.sendStatCounter("socket.error.unexpected_closed",b),this._stats.sendStatCounter("socket.error.close."+e.code,b);var n="pubsub-js-client unexpected_close. code: "+e.code+", reason: "+e.reason+", wasClean: "+e.wasClean;this._stats.sendStatLogger(n),this._closed=!0,this._trigger("connection_failure")}}},{key:"_onOpen",value:function(e){_.debug(this._id+" socket opened"),this._connectionAttempts=0,this._connecting=!1,this._socketConnectTime&&this._stats.sendStatTimer("socket.connect",h["default"].time.now()-this._socketConnectTime,E),this._stats.sendStatCounter("socket.connection_retries."+this._connectionAttempts,k),this._ping(),this._pingInterval=window.setInterval(this._ping.bind(this),y),this._trigger("open")}},{key:"_ping",value:function(){_.debug(this._id+"sending PING");try{this._socket.send(JSON.stringify({type:"PING"})),this._sentPing=!0,this._pongTimeout&&clearTimeout(this._pongTimeout),this._pongTimeout=setTimeout(this._pongTimedOut.bind(this),m)}catch(e){this._stats.sendStatCounter("socket.error.ping_send_error",b),this._stats.sendStatLogger("ping error: closed: "+this._closed+", error: "+e),this.close()}}},{key:"_pongTimedOut",value:function(){this._sentPing&&!this._receivedPong&&(_.debug(this._id+"Pong timed out!"),this._stats.sendStatCounter("socket.error.pong_timed_out",b),this.close())}},{key:"_clearTimeouts",value:function(){this._sentPing=this._receivedPong=!1,clearTimeout(this._pongTimeout),clearInterval(this._pingInterval),clearTimeout(this._nextConnectionAttempt)}},{key:"_beforeUnload",value:function(){this._windowUnloading=!0}}]),t}(c["default"]);t["default"]=w},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="https://client-event-reporter-darklaunch.twitch.tv",o="https://client-event-reporter.twitch.tv",s="pubsub-js-client.darklaunch.",a="pubsub-js-client.production.",u=3e4,c=function(){function e(t){switch(n(this,e),this._env=t.env,this._env){case"production":this._addr=o,this._prefix=a;break;case"darklaunch":this._addr=i,this._prefix=s;break;default:this._addr=i,this._prefix=s}}return r(e,[{key:"setPrefix",value:function(e){this._prefix=e}},{key:"sendStatCounter",value:function(e,t){Math.random()<t&&$.ajax({type:"POST",url:this._addr+"/v1/counter",timeout:u,data:{key:this._prefix+e,count:"1",sample_rate:t}})}},{key:"sendStatTimer",value:function(e,t,n){Math.random()<n&&$.ajax({type:"POST",url:this._addr+"/v1/timer",timeout:u,data:{key:this._prefix+e,milliseconds:t,sample_rate:n}})}},{key:"sendStatLogger",value:function(e){$.ajax({type:"POST",url:this._addr+"/v1/logger",timeout:u,data:{log_line:e}})}},{key:"sendStatGauge",value:function(e){$.ajax({type:"POST",url:this._addr+"/v1/gauge",data:{key:e}})}}]),e}();t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(173),a=r(s),u=n(179),c=(r(u),n(172)),l=r(c),f="https://pubster.twitch.tv/publish",d="https://pubster-darklaunch.twitch.tv/publish",h="pubsubtest.unique.",p="pubsubtest.shared."+a["default"].randomInt(2),_=1e-4,v=6e4,g=3e4,m=.1,y=1,b=l["default"]._getLogger("PubsubTest"),E=function(){function e(t){switch(i(this,e),b.debug("PubsubTest enabled"),this._env=t.env,this._driver=t.driver,this._stats=t.stats,this._env){case"production":this._addr=f;break;case"darklaunch":this._addr=d;break;default:this._env="production",this._addr=f}this._statKeys={uniqueSuccess:"test.unique.success",uniqueFailure:"test.unique.failure",sharedSuccess:"test.shared.success",sharedFailure:"test.shared.failure"},this._uniqueKey=h+a["default"].generateString(20),this._sharedKey=p,this._listeningUnique=this._listeningShared=!1,this.sendListens()}return o(e,[{key:"sendListens",value:function(){this._driver.Listen({topic:this._uniqueKey,auth:"",success:this._gotUniqueOk.bind(this),failure:this._gotUniqueFail.bind(this),message:this._gotUniqueMessage.bind(this)}),this._driver.Listen({topic:this._sharedKey,auth:"",success:this._gotSharedOk.bind(this),failure:this._gotSharedFail.bind(this),message:this._gotSharedMessage.bind(this)})}},{key:"_gotUniqueOk",value:function(){this._listeningUnique=!0,this._listeningShared&&this.startTesting()}},{key:"_gotUniqueFail",value:function(e){}},{key:"_gotSharedOk",value:function(){this._listeningShared=!0,this._listeningUnique&&this.startTesting()}},{key:"_gotSharedFail",value:function(e){}},{key:"startTesting",value:function(){b.debug("startTesting"),this._driver.on("connected",this.resumeTesting,this),this._driver.on("disconnected",this.stopTesting,this),this.checkAndSend(),this._publishInterval=window.setInterval(this.checkAndSend.bind(this),v)}},{key:"resumeTesting",value:function(){b.debug("resumeTesting"),this.checkAndSend(),this._publishInterval=window.setInterval(this.checkAndSend.bind(this),v)}},{key:"stopTesting",value:function(){b.debug("stopTesting"),clearInterval(this._publishInterval),this._receivedUniqueMessage=this._sentUniqueMessage=!1,this._receivedSharedMessage=this._sentSharedMessage=!1}},{key:"checkAndSend",value:function(){b.debug("checkAndSend: unique: sent = "+this._sentUniqueMessage+", received = "+this._receivedUniqueMessage),!this._receivedUniqueMessage&&this._sentUniqueMessage&&(b.debug("unique failure"),this._stats.sendStatCounter(this._statKeys.uniqueFailure,y)),!this._receivedSharedMessage&&this._sentSharedMessage&&(b.debug("shared failure"),this._stats.sendStatCounter(this._statKeys.sharedFailure,y)),this._receivedUniqueMessage=this._sentUniqueMessage=!1,this._receivedSharedMessage=this._sentSharedMessage=!1,this._expectedMessage=a["default"].generateString(30),$.ajax({type:"POST",url:this._addr,contentType:"application/json",timeout:g,data:JSON.stringify({topics:[this._uniqueKey],data:this._expectedMessage}),success:function(){b.debug("unique message sent"),this._sentUniqueMessage=!0}.bind(this)}),this._sentUniqueMessageTime=a["default"].time.now(),Math.random()<_&&($.ajax({type:"POST",url:this._addr,contentType:"application/json",timeout:g,data:JSON.stringify({topics:[this._sharedKey],data:this._expectedMessage}),success:function(){b.debug("shared message sent"),this._sentSharedMessage=!0}.bind(this)}),this._sentSharedMessageTime=a["default"].time.now())}},{key:"_gotUniqueMessage",value:function(e){if(b.debug("received unique message: "+e),e===this._expectedMessage){var t=a["default"].time.now()-this._sentUniqueMessageTime;this._receivedUniqueMessage=!0,this._stats.sendStatTimer(this._statKeys.uniqueSuccess,t,m),this._stats.sendStatCounter(this._statKeys.uniqueSuccess,m)}}},{key:"_gotSharedMessage",value:function(e){if(e===this._expectedMessage){var t=a["default"].time.now()-this._sentSharedMessageTime;this._receivedSharedMessage=!0,this._stats.sendStatTimer(this._statKeys.sharedSuccess,t,m),this._stats.sendStatCounter(this._statKeys.sharedSuccess,m)}}}]),e}();t["default"]=E},function(e,t){"use strict";function n(e,t,n){var r=e.getState();return e.subscribe(function(){var i=!1,o=e.getState(),s=t.reduce(function(e,t){return o[t]!==r[t]&&(e[t]=o[t],i=!0),e},{});i&&n(s,r),r=o})}Object.defineProperty(t,"__esModule",{value:!0}),t.subscribe=n},function(e,t){"use strict";function n(e){return{type:r,count:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updateViewerCount=n;var r=t.ACTION_UPDATE_VIEWERCOUNT="update viewercount"},function(e,t){"use strict";function n(e){return{type:r,online:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.setOnline=n;var r=t.ACTION_SET_ONLINE="set online"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.LiveContentStream=t.CONTENT_MODE_LIVE=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(140),a=r(s),u=n(4),c=r(u),l=n(66),f=n(185),d=t.CONTENT_MODE_LIVE="live";t.LiveContentStream=function(){function e(t,n,r,o){i(this,e),this._channelName=t,this._oAuthToken=n,this._accessToken=r,this._usherParams=o}return o(e,[{key:"contentType",get:function(){return d}},{key:"channel",get:function(){return this._channelName}},{key:"videoId",get:function(){return""}},{key:"streamUrl",get:function(){var e=this;return(0,f.fetchChannelAccessToken)(this._channelName,this._oAuthToken).then(function(t){var n=(0,a["default"])({token:t.token,sig:t.sig,allow_source:!0,allow_spectre:!0},(0,c["default"])(e._usherParams,["protocol"]));return Promise.resolve(""+e._usherParams.protocol+l.usherHost+"/api/channel/hls/"+e._channelName.toLowerCase()+".m3u8?"+$.param(n))})}}]),e}()},function(e,t,n){"use strict";function r(e,t){return(0,s.fetch)({url:e,data:{oauth_token:t},xhrFields:{withCredentials:!0}})}function i(e,t){var n=a.apiHost+"/api/vods/"+e.substring(1)+"/access_token";return r(n,t)}function o(e,t){var n=a.apiHost+"/api/channels/"+e+"/access_token";return r(n,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAccessToken=r,t.fetchVideoAccessToken=i,t.fetchChannelAccessToken=o;var s=n(139),a=n(66)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.FullScreen=t.FULLSCREEN_CHANGE=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(187),a=r(s),u=n(76),c=r(u),l=t.FULLSCREEN_CHANGE="fullscreenchange";t.FullScreen=function(){function e(t){i(this,e),this._root=t,this._eventEmitter=new c["default"]}return o(e,[{key:"addEventListener",value:function(e,t){this._eventEmitter.addListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._eventEmitter.removeListener(e,t)}},{key:"canFullScreen",value:function(){return a["default"].enabled}},{key:"isFullScreen",value:function(){return a["default"].element===this._root}},{key:"setFullScreen",value:function(e){if(this.isFullScreen()!==e){var t=this._onFullScreenChange.bind(this);a["default"].toggle(this._root,t,t)}}},{key:"_onFullScreenChange",value:function(){this._eventEmitter.emit(l)}},{key:"destroy",value:function(){this._eventEmitter.removeAllListeners()}}]),e}()},function(e,t,n){var r;/*! BigScreen
	 * v2.0.5 - 2015-05-02
	 * 
	 * Copyright 2015 Brad Dougherty <me@brad.is>; MIT License
	 */
!function(i,o,s){"use strict";function a(e){var t=null;if("VIDEO"===e.tagName)t=e;else{var n=e.getElementsByTagName("video");n[0]&&(t=n[0])}return t}function u(e){var t=a(e);if(t&&t.webkitEnterFullscreen){try{t.readyState<t.HAVE_METADATA?(t.addEventListener("loadedmetadata",function r(){t.removeEventListener("loadedmetadata",r,!1),t.webkitEnterFullscreen(),_=!!t.getAttribute("controls")},!1),t.load()):(t.webkitEnterFullscreen(),_=!!t.getAttribute("controls")),p=t}catch(n){return E("not_supported",e)}return!0}return E(void 0===h.request?"not_supported":"not_enabled",e)}function c(){k.element||(b(),f())}function l(){s&&"webkitfullscreenchange"===h.change&&window.addEventListener("resize",c,!1)}function f(){s&&"webkitfullscreenchange"===h.change&&window.removeEventListener("resize",c,!1)}var d=/i(Pad|Phone|Pod)/.test(navigator.userAgent)&&parseInt(navigator.userAgent.replace(/^.*OS (\d+)_(\d+).*$/,"$1.$2"),10)>=7,h=function(){var e=o.createElement("video"),t={request:["requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"],exit:["exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],enabled:["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"],element:["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"],change:["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],error:["fullscreenerror","webkitfullscreenerror","mozfullscreenerror","MSFullscreenError"]},n={};for(var r in t)for(var i=0,s=t[r].length;s>i;i++)if(t[r][i]in e||t[r][i]in o||"on"+t[r][i].toLowerCase()in o){n[r]=t[r][i];break}return n}(),p=null,_=null,v=function(){},g=[],m=!1;navigator.userAgent.indexOf("Android")>-1&&navigator.userAgent.indexOf("Chrome")>-1&&(m=parseInt(navigator.userAgent.replace(/^.*Chrome\/(\d+).*$/,"$1"),10)||!0);var y=function(e){var t=g[g.length-1];t&&(e!==t.element&&e!==p||!t.hasEntered)&&("VIDEO"===e.tagName&&(p=e),1===g.length&&k.onenter(k.element),t.enter.call(t.element,e||t.element),t.hasEntered=!0)},b=function(){!p||_||d||(p.setAttribute("controls","controls"),p.removeAttribute("controls")),p=null,_=null;var e=g.pop();e&&(e.exit.call(e.element),k.element||(g.forEach(function(e){e.exit.call(e.element)}),g=[],k.onexit()))},E=function(e,t){if(g.length>0){var n=g.pop();t=t||n.element,n.error.call(t,e),k.onerror(t,e)}},k={request:function(e,t,n,r){if(e=e||o.body,g.push({element:e,enter:t||v,exit:n||v,error:r||v}),void 0===h.request)return void u(e);if(s&&o[h.enabled]===!1)return void u(e);if(m!==!1&&32>m)return void u(e);if(s&&void 0===h.enabled)return h.enabled="webkitFullscreenEnabled",e[h.request](),void setTimeout(function(){o[h.element]?o[h.enabled]=!0:(o[h.enabled]=!1,u(e))},250);try{e[h.request](),setTimeout(function(){o[h.element]||E(s?"not_enabled":"not_allowed",e)},100)}catch(i){E("not_enabled",e)}},exit:function(){f(),o[h.exit]()},toggle:function(e,t,n,r){k.element?k.exit():k.request(e,t,n,r)},videoEnabled:function(e){if(k.enabled)return!0;e=e||o.body;var t=a(e);return t&&void 0!==t.webkitSupportsFullscreen?t.readyState<t.HAVE_METADATA?"maybe":t.webkitSupportsFullscreen:!1},onenter:v,onexit:v,onchange:v,onerror:v};try{Object.defineProperties(k,{element:{enumerable:!0,get:function(){return p&&p.webkitDisplayingFullscreen?p:o[h.element]||null}},enabled:{enumerable:!0,get:function(){return"webkitCancelFullScreen"!==h.exit||s?m!==!1&&32>m?!1:o[h.enabled]||!1:!0}}}),h.change&&o.addEventListener(h.change,function(e){if(k.onchange(k.element),k.element){var t=g[g.length-2];t&&t.element===k.element?b():(y(k.element),l())}else b()},!1),o.addEventListener("webkitbeginfullscreen",function(e){var t=!0;if(g.length>0)for(var n=0,r=g.length;r>n;n++){var i=a(g[n].element);if(i===e.srcElement){t=!1;break}}t&&g.push({element:e.srcElement,enter:v,exit:v,error:v}),k.onchange(e.srcElement),y(e.srcElement)},!0),o.addEventListener("webkitendfullscreen",function(e){k.onchange(e.srcElement),b(e.srcElement)},!0),h.error&&o.addEventListener(h.error,function(e){E("not_allowed")},!1)}catch(w){k.element=null,k.enabled=!1}r=function(){return k}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))}(this,document,self!==top)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=s(e);return function(n,r){n({type:E,stream:_.nullContentStream});var i=r(),o=i.experiments,s=i.usher,a=o.get(m.USHER_PROTOCOL);return Promise.all([a,u()]).then(function(r){var i=c(r,2),o=i[0],a=i[1];(0,p.fetchChannelAccessToken)(e,a).then(function(r){n({type:E,stream:new v.LiveContentStream(t,a,r,(0,f["default"])({},s,{protocol:o}))}),(0,y.streamInfo)(e).then(function(e){e.stream&&n((0,b.updateViewerCount)(e.stream.viewers))})})})}}function o(e){var t=a(e);return function(e,n){e({type:E,stream:_.nullContentStream});var r=n(),i=r.experiments,o=r.usher,s=i.get(m.USHER_PROTOCOL),a=i.get(m.USE_LANTERN);return Promise.all([s,a,u()]).then(function(n){var r=c(n,3),i=r[0],s=r[1],a=r[2];(0,p.fetchVideoAccessToken)(t,a).then(function(n){e({type:E,stream:new g.VODContentStream(t,a,n,(0,f["default"])({},o,{protocol:i,use_lantern:s}))})})})}}function s(e){return e.replace(/[^A-Za-z0-9_]/g,"")}function a(e){return e.replace(/[^A-Za-z0-9_]/g,"")}function u(){return(0,h.fetch)({url:d.apiHost+"/api/viewer/token.json",xhrFields:{withCredentials:!0}}).then(function(e){return e.token},function(){return null})}Object.defineProperty(t,"__esModule",{value:!0}),t.ACTION_SET_STREAM=void 0;var c=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(u){i=!0,o=u}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.setChannel=i,t.setVideo=o;var l=n(140),f=r(l),d=n(66),h=n(139),p=n(185),_=n(189),v=n(184),g=n(190),m=n(152),y=n(147),b=n(182),E=t.ACTION_SET_STREAM="set stream"},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=t.CONTENT_MODE_NONE=null,o=function(){function e(){n(this,e)}return r(e,[{key:"contentType",get:function(){return i}},{key:"channel",get:function(){return""}},{key:"videoId",get:function(){return""}},{key:"streamUrl",get:function(){return Promise.resolve("")}}]),e}();t.nullContentStream=new o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.VODContentStream=t.CONTENT_MODE_VOD=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(140),a=r(s),u=n(4),c=r(u),l=n(66),f=n(185),d=t.CONTENT_MODE_VOD="vod";t.VODContentStream=function(){function e(t,n,r,o){i(this,e),this._vodId=t,this._oAuthToken=n,this._accessToken=r,this._usherParams=o}return o(e,[{key:"contentType",get:function(){return d}},{key:"channel",get:function(){return""}},{key:"videoId",get:function(){return this._vodId}},{key:"streamUrl",get:function(){var e=this;return(0,f.fetchVideoAccessToken)(this._vodId,this._oAuthToken).then(function(t){var n=(0,a["default"])({nauth:t.token,nauthsig:t.sig,allow_source:!0,allow_spectre:!0},(0,c["default"])(e._usherParams,["protocol"]));return Promise.resolve(""+e._usherParams.protocol+l.usherHost+"/vod/"+e._vodId.substring(1)+".m3u8?"+$.param(n))})}}]),e}()},function(e,t,n){function r(e){return"number"==typeof e&&o(e)}var i=n(18),o=i.isFinite;e.exports=r}])});